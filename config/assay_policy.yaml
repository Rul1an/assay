# Assay MCP Policy for Claude Desktop
# Location: ~/.config/claude/assay_policy.yaml

# [PATCHED] 2026-01-05
# Fixed regex anchors to properly block absolute paths.
# Added support for both 'read_file' and 'read_text_file' (different server versions).

tools:
  deny:
    - exec_shell
    - system_command
    - delete_file

constraints:
  run_command:
    deny_patterns:
      # Block dangerous prefix matches (start of string OR start of command after &&/;)
      command: '(^|;|&&)\s*(rm|sudo|chmod|chown|dd|mkfs|wget|curl).*'
      cwd: '^/(etc|root|sys|proc|boot|dev)'

  # Standard MCP Filesystem
  read_file:
    deny_patterns:
      # Block sensitive files anywhere in the path
      path: '(/etc/passwd|/etc/shadow|/root/|/\.ssh/|/\.aws/|\.env)'

  # Variant Name (seen in audit logs)
  read_text_file:
    deny_patterns:
      path: '(/etc/passwd|/etc/shadow|/root/|/\.ssh/|/\.aws/|\.env)'

  write_file:
    deny_patterns:
      file_path: '\.(exe|sh|bat|ps1|app|dmg)$'

limits:
  max_tool_calls_total: 200
