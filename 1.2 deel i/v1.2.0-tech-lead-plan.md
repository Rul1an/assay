# v1.2.0 Tech Lead Plan

**Versie:** 1.2.0  
**Duur:** 4 weken  
**Start:** Week na v1.1.0 feedback verzameling  
**Hoofdthema:** Python Ecosystem Integration

---

## Strategische Prioritering

### Must Have (P0)
| Feature | Rationale | Owner |
|---------|-----------|-------|
| Python SDK | 80% van AI/ML devs zit in Python | SDK/DX Engineer |
| `explain` → stable | Code done, alleen docs + flag removal | Tech Lead |

### Should Have (P1)
| Feature | Rationale | Owner |
|---------|-----------|-------|
| Baseline management | "main = baseline" voor regressions | Tech Lead |
| v1.1 bug fixes | Feedback design partners | Wie relevant |

### Nice to Have (P2 → v1.3)
| Feature | Rationale | Defer reason |
|---------|-----------|--------------|
| LangChain adapter | Ecosystem play | Wacht op SDK feedback |
| LlamaIndex adapter | Ecosystem play | Volgt LangChain pattern |
| SARIF output | Security tooling | Niche use case |

---

## Team Toewijzingen

### Tech Lead (jij)
```
Week 1: Architectuur & Beslissingen
├── Python SDK API design review
├── Beslissing: sync vs async
├── Beslissing: pyo3 vs pure Python wrapper
└── `explain` promoten: flag removal + docs

Week 2-3: Baseline Management
├── Implementatie baseline diffing
├── `assay baseline save` command
├── `assay coverage --baseline main` flag
└── Integration tests

Week 4: Release prep
├── Code review alle PRs
├── Performance benchmarks
├── Release notes
└── v1.2.0 tag
```

### SDK/DX Engineer
```
Week 1-2: Python SDK Core
├── PyO3 bindings voor CoverageAnalyzer
├── PyO3 bindings voor TraceExplainer
├── Wheel building (manylinux, macos, windows)
└── `pip install assay` werkend

Week 3: Python DX
├── Type hints (.pyi stubs)
├── Python-idiomatic API wrapper
├── pytest integration
└── Examples: "5 lines to first coverage check"

Week 4: Polish
├── PyPI publish workflow
├── README.md voor PyPI
├── Troubleshooting guide
└── Design partner testing
```

### Evals Lead
```
Week 1: v1.1 Feedback Analysis
├── Design partner feedback verzamelen
├── False positive/negative analyse
├── Metric accuracy review
└── Prioritized bug list

Week 2-3: Eval Improvements
├── Coverage metric refinement (als nodig)
├── Rule coverage accuracy
├── Test suite hardening
└── Edge case documentation

Week 4: Validation
├── Python SDK eval correctness
├── Baseline diff accuracy
├── Sign-off op release quality
└── Regression test suite update
```

### Product/DevRel
```
Week 1: Design Partner Outreach
├── v1.1.0 announcement
├── Parloa/Celonis check-in calls
├── Feedback verzamelen
└── Python SDK demand validation

Week 2-3: Content & Docs
├── Python SDK docs
├── Migration guide v1.1 → v1.2
├── Blog post: "Assay + Python"
└── Demo video update

Week 4: Launch Prep
├── PyPI listing optimization
├── Launch announcement draft
├── Community engagement plan
└── Success metrics tracking
```

---

## Technische Beslissingen (Week 1)

### Beslissing 1: Python Binding Approach

**Opties:**

| Approach | Pro | Con |
|----------|-----|-----|
| PyO3 (Rust → Python) | Performance, single codebase | Complex build, manylinux hassle |
| Pure Python + subprocess | Simple, no native deps | Slower, clunky DX |
| gRPC/HTTP wrapper | Language agnostic | Overhead, extra process |

**Aanbeveling:** PyO3

Rationale:
- Performance matters voor CI (elke seconde telt)
- We hebben al Rust core
- manylinux is opgelost probleem (zie: `maturin`)
- Competitor landscape (Pydantic, Polars) bewijst viability

**Actie:** SDK/DX Engineer start met `maturin new` skeleton Week 1 Day 1.

---

### Beslissing 2: Sync vs Async Python API

**Opties:**

| Approach | Pro | Con |
|----------|-----|-----|
| Sync only | Simple, pytest friendly | Blocks in async apps |
| Async only | Modern, non-blocking | Complexity, sync users gefrustreerd |
| Both (sync default, async optional) | Flexibel | Meer code te maintainen |

**Aanbeveling:** Sync default, async later (v1.3)

Rationale:
- 90% use case is CI/CD scripts (sync)
- pytest default is sync
- Async toevoegen is backward compatible
- Ship fast > feature complete

**Actie:** SDK alleen sync in v1.2, async als P1 voor v1.3.

---

### Beslissing 3: Python Package Structuur

```
assay/
├── __init__.py          # Main exports
├── _native.cpython-*.so # PyO3 compiled module
├── coverage.py          # Pythonic wrapper
├── explain.py           # Pythonic wrapper  
├── policy.py            # Policy dataclasses
└── py.typed             # PEP 561 marker
```

**API Design:**

```python
from assay import CoverageAnalyzer, Policy

# Load policy
policy = Policy.from_file("policy.yaml")

# Analyze traces
analyzer = CoverageAnalyzer(policy)
report = analyzer.analyze(
    traces=[
        {"tools": ["Search", "Create"]},
        {"tools": ["Search", "Update"]},
    ],
    threshold=80.0
)

# Results
print(f"Coverage: {report.overall_coverage_pct}%")
print(f"Meets threshold: {report.meets_threshold}")

# For pytest
assert report.meets_threshold, f"Coverage {report.overall_coverage_pct}% below 80%"
```

**Actie:** Dit is de target API. SDK/DX Engineer implementeert exact dit.

---

### Beslissing 4: Baseline Storage Format

```yaml
# .assay/baseline.yaml (auto-generated)
version: "1.0"
created: "2026-01-15T10:00:00Z"
commit: "abc123"
branch: "main"

coverage:
  overall_pct: 85.5
  tool_coverage:
    total: 12
    seen: 10
  rule_coverage:
    total: 8
    triggered: 7

tools_seen:
  - Search
  - Create
  - Update
  # ...

rules_triggered:
  - before_search_then_create
  - max_calls_api_5
  # ...
```

**CLI:**

```bash
# Save current as baseline
assay baseline save --output .assay/baseline.yaml

# Compare against baseline
assay coverage --policy policy.yaml --traces traces/ --baseline .assay/baseline.yaml

# Output shows diff:
# Coverage: 82.5% (baseline: 85.5%, Δ -3.0%) ⚠️
# New uncovered: DeleteAccount
# Newly covered: Archive
```

**Actie:** Tech Lead implementeert Week 2-3.

---

## Sprint Planning

### Week 1: Foundation

| Day | Tech Lead | SDK/DX | Evals Lead | Product |
|-----|-----------|--------|------------|---------|
| Mon | API design review | maturin setup | Feedback calls | v1.1 announcement |
| Tue | Beslissingen finaliseren | PyO3 skeleton | Feedback synthesis | Partner calls |
| Wed | `explain` stable PR | CoverageAnalyzer binding | Bug triage | Docs planning |
| Thu | Code review | TraceExplainer binding | Metric review | Content outline |
| Fri | Week 1 retro | Wheel build test | Test plan | Feedback report |

**Week 1 Exit Criteria:**
- [ ] `explain` flag removed, docs updated
- [ ] `pip install` works locally (niet PyPI)
- [ ] Design partner feedback synthesized
- [ ] All technical decisions documented

---

### Week 2: Core Development

| Day | Tech Lead | SDK/DX | Evals Lead | Product |
|-----|-----------|--------|------------|---------|
| Mon | Baseline: data model | Type hints | Coverage tests | Python docs draft |
| Tue | Baseline: save cmd | Python wrapper | Rule tests | Migration guide |
| Wed | Baseline: diff logic | pytest helpers | Edge cases | Blog draft |
| Thu | Integration tests | Examples | Validation | Demo prep |
| Fri | Code review | manylinux builds | Sign-off | Review cycle |

**Week 2 Exit Criteria:**
- [ ] `assay baseline save` works
- [ ] Python SDK feature complete
- [ ] Test suite 100% passing
- [ ] Docs draft complete

---

### Week 3: Integration & Polish

| Day | Tech Lead | SDK/DX | Evals Lead | Product |
|-----|-----------|--------|------------|---------|
| Mon | Baseline: CLI integration | PyPI test upload | Python SDK validation | Docs review |
| Tue | Baseline: tests | Windows wheel fix | Baseline validation | Partner preview |
| Wed | Performance bench | macOS ARM wheel | Full regression | Feedback |
| Thu | Bug fixes | Bug fixes | Bug fixes | Launch prep |
| Fri | Feature freeze | Feature freeze | Final validation | Announce draft |

**Week 3 Exit Criteria:**
- [ ] All features complete
- [ ] PyPI test upload successful
- [ ] Performance acceptable (<100ms voor typical policy)
- [ ] Design partner sign-off

---

### Week 4: Release

| Day | Tech Lead | SDK/DX | Evals Lead | Product |
|-----|-----------|--------|------------|---------|
| Mon | RC tag | PyPI RC | RC testing | RC announcement |
| Tue | RC fixes | RC fixes | RC validation | Feedback monitor |
| Wed | Final fixes | Final fixes | Final sign-off | Launch content |
| Thu | v1.2.0 tag | PyPI publish | Release validation | Announcement |
| Fri | Retro | Retro | Retro | Metrics review |

**Week 4 Exit Criteria:**
- [ ] v1.2.0 tagged and released
- [ ] PyPI package live
- [ ] Announcement published
- [ ] Zero P0 bugs

---

## Risico's & Mitigaties

| Risico | Impact | Likelihood | Mitigatie |
|--------|--------|------------|-----------|
| manylinux build fails | High | Medium | Early testing Week 1, fallback to source dist |
| PyO3 memory issues | High | Low | Extensive testing, Evals Lead validation |
| Design partner feedback vraagt grote changes | Medium | Medium | Week 1 feedback synthesis, scope lock Week 2 |
| Windows wheel issues | Medium | High | Dedicated time Week 3, CI matrix |
| Baseline diff logic bugs | Medium | Medium | Property-based testing, manual review |

---

## Definition of Done: v1.2.0

### Features
- [ ] `pip install assay` works on Linux, macOS, Windows
- [ ] `from assay import CoverageAnalyzer` works
- [ ] `assay explain` is stable (no --experimental flag)
- [ ] `assay baseline save/--baseline` works
- [ ] All v1.1.0 functionality preserved

### Quality
- [ ] 100% tests passing
- [ ] No P0/P1 Clippy warnings
- [ ] <100ms voor 1000-tool trace evaluation
- [ ] Type hints complete (.pyi)
- [ ] Docs complete

### Release
- [ ] GitHub release with binaries
- [ ] PyPI package published
- [ ] Changelog updated
- [ ] Migration guide published
- [ ] Design partners notified

---

## Communicatie Ritme

| Wat | Wanneer | Wie | Format |
|-----|---------|-----|--------|
| Daily standup | 09:00 | All | 15min sync |
| Tech decisions | As needed | Tech Lead + relevant | Slack thread → ADR |
| Weekly demo | Friday 15:00 | All | 30min show & tell |
| Design partner sync | Week 1, 3 | Product + Tech Lead | 30min call |
| Release go/no-go | Week 4 Wed | All | 30min meeting |

---

## Success Metrics (30 dagen post-release)

| Metric | Target | Measurement |
|--------|--------|-------------|
| PyPI downloads | >500 | PyPI stats |
| GitHub stars delta | +50 | GitHub |
| Design partner Python adoption | 2/2 | Direct feedback |
| P0 bugs | 0 | Issue tracker |
| Time to first Python coverage | <10 min | Manual test |

---

## Open Vragen (te beantwoorden Week 1)

1. **Minimum Python version?** 
   - Voorstel: 3.9+ (drops 3.8 die EOL is)
   
2. **Pandas/Polars integration?**
   - Voorstel: Defer naar v1.3, focus op core eerst
   
3. **Jupyter notebook support?**
   - Voorstel: Works by default (sync API), no special handling

4. **Error messages: Rust errors of Python exceptions?**
   - Voorstel: Wrap in Python exceptions met clear messages

---

## Appendix: Claude Taken

Wat ik kan voorbereiden/genereren op verzoek:

```
□ PyO3 binding skeleton voor CoverageAnalyzer
□ PyO3 binding skeleton voor TraceExplainer  
□ Python type hints (.pyi file)
□ pytest fixture voorbeelden
□ Baseline data model (Rust structs)
□ Baseline CLI implementation
□ Migration guide draft
□ CHANGELOG v1.2.0 draft
□ Test cases voor baseline diffing
□ Property-based tests voor coverage accuracy
```

**Vraag me wanneer je een van deze nodig hebt.**
