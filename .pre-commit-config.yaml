# .pre-commit-config.yaml
minimum_pre_commit_version: "3.6.0"

# Best practice: pin versions (rev) and periodically `pre-commit autoupdate`.
repos:
  # Baseline hygiene (stable, fast)
  - repo: https://github.com/pre-commit/pre-commit-hooks
    rev: v4.6.0
    hooks:
      - id: check-merge-conflict
      - id: check-yaml
        args: ["--unsafe"]
        exclude: |
          (?x)^(
            tests/fixtures/mcp/malformed\.yaml|
            tests/fixtures/golden/eval_broken\.yaml
          )$
      - id: check-toml
      - id: end-of-file-fixer
      - id: trailing-whitespace

  # --- Tooling hooks (system) ---
  # typos (spellcheck)
  - repo: local
    hooks:
      - id: typos
        name: typos (spellcheck)
        entry: typos
        language: system
        types_or: [text]
        args: ["--config", ".typos.toml"]
        pass_filenames: true
        exclude: |
          (?x)^(
            crates/assay-ebpf/src/vmlinux\.rs|
            docs/MCP_TESTPLAN_CLAUDE_DESKTOP\.md|
            examples/.*|
            .*\.jsonl$
          )

  # actionlint (GitHub Actions workflow lint)
  - repo: local
    hooks:
      - id: actionlint
        name: actionlint (GitHub Actions)
        entry: actionlint
        language: system
        files: ^\.github/workflows/.*\.ya?ml$

  # shellcheck (bash)
  - repo: local
    hooks:
      - id: shellcheck
        name: shellcheck
        entry: shellcheck
        language: system
        types: [shell]
        args: ["-x", "-S", "warning"]

  # --- Rust: fmt on commit (fast), clippy on push (heavier) ---
  - repo: local
    hooks:
      - id: cargo-fmt
        name: cargo fmt --check
        entry: bash -lc 'cargo fmt --all -- --check'
        language: system
        types_or: [rust]
        pass_filenames: false

      - id: cargo-clippy
        name: cargo clippy (workspace, deny warnings)
        entry: bash -lc 'cargo clippy --workspace --all-targets --all-features -- -D warnings'
        language: system
        stages: [pre-push]
        pass_filenames: false
