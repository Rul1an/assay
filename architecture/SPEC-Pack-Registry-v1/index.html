<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="The purity test for AI — Zero-flake CI for AI agents"><meta name=author content="Assay Team"><link href=https://docs.assay.dev/architecture/SPEC-Pack-Registry-v1/ rel=canonical><link rel=icon href=../../assets/logo.svg><meta name=generator content="mkdocs-1.6.1, mkdocs-material-9.5.28"><title>SPEC-Pack-Registry-v1 - Assay</title><link rel=stylesheet href=../../assets/stylesheets/main.6543a935.min.css><link rel=stylesheet href=../../assets/stylesheets/palette.06af60db.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Inter:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback"><style>:root{--md-text-font:"Inter";--md-code-font:"JetBrains Mono"}</style><link rel=stylesheet href=../../stylesheets/extra.css><script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script><script id=__analytics>function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-XXXXXXXXXX"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-XXXXXXXXXX",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-XXXXXXXXXX",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script><script>"undefined"!=typeof __md_analytics&&__md_analytics()</script></head> <body dir=ltr data-md-color-scheme=default data-md-color-primary=deep-purple data-md-color-accent=green> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#spec-pack-registry-v1 class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <div data-md-color-scheme=default data-md-component=outdated hidden> </div> <header class="md-header md-header--shadow md-header--lifted" data-md-component=header> <nav class="md-header__inner md-grid" aria-label=Header> <a href=../.. title=Assay class="md-header__button md-logo" aria-label=Assay data-md-component=logo> <img src=../../assets/logo.svg alt=logo> </a> <label class="md-header__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg> </label> <div class=md-header__title data-md-component=header-title> <div class=md-header__ellipsis> <div class=md-header__topic> <span class=md-ellipsis> Assay </span> </div> <div class=md-header__topic data-md-component=header-topic> <span class=md-ellipsis> SPEC-Pack-Registry-v1 </span> </div> </div> </div> <form class=md-header__option data-md-component=palette> <input class=md-option data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme=default data-md-color-primary=deep-purple data-md-color-accent=green aria-label="Switch to dark mode" type=radio name=__palette id=__palette_0> <label class="md-header__button md-icon" title="Switch to dark mode" for=__palette_1 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a4 4 0 0 0-4 4 4 4 0 0 0 4 4 4 4 0 0 0 4-4 4 4 0 0 0-4-4m0 10a6 6 0 0 1-6-6 6 6 0 0 1 6-6 6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> <input class=md-option data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme=slate data-md-color-primary=deep-purple data-md-color-accent=green aria-label="Switch to light mode" type=radio name=__palette id=__palette_1> <label class="md-header__button md-icon" title="Switch to light mode" for=__palette_0 hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 18c-.89 0-1.74-.2-2.5-.55C11.56 16.5 13 14.42 13 12c0-2.42-1.44-4.5-3.5-5.45C10.26 6.2 11.11 6 12 6a6 6 0 0 1 6 6 6 6 0 0 1-6 6m8-9.31V4h-4.69L12 .69 8.69 4H4v4.69L.69 12 4 15.31V20h4.69L12 23.31 15.31 20H20v-4.69L23.31 12 20 8.69Z"/></svg> </label> </form> <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script> <label class="md-header__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg> </label> <nav class=md-search__options aria-label=Search> <a href=javascript:void(0) class="md-search__icon md-icon" title=Share aria-label=Share data-clipboard data-clipboard-text data-md-component=search-share tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08Z"/></svg> </a> <button type=reset class="md-search__icon md-icon" title=Clear aria-label=Clear tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg> </button> </nav> <div class=md-search__suggest data-md-component=search-suggest></div> </form> <div class=md-search__output> <div class=md-search__scrollwrap tabindex=0 data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list role=presentation></ol> </div> </div> </div> </div> </div> <div class=md-header__source> <a href=https://github.com/Rul1an/assay title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> Rul1an/assay </div> </a> </div> </nav> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class=md-grid> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=../.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../../getting-started/ class=md-tabs__link> Getting Started </a> </li> <li class=md-tabs__item> <a href=../../concepts/ class=md-tabs__link> Core Concepts </a> </li> <li class=md-tabs__item> <a href=../../python-sdk/ class=md-tabs__link> Python SDK </a> </li> <li class=md-tabs__item> <a href=../../mcp/ class=md-tabs__link> MCP Integration </a> </li> <li class=md-tabs__item> <a href=../../reference/config/ class=md-tabs__link> Configuration </a> </li> <li class=md-tabs__item> <a href=../../reference/cli/ class=md-tabs__link> CLI Reference </a> </li> <li class=md-tabs__item> <a href=../../metrics/ class=md-tabs__link> Metrics Reference </a> </li> <li class=md-tabs__item> <a href=../../use-cases/ class=md-tabs__link> Use Cases </a> </li> <li class=md-tabs__item> <a href=../../guides/ class=md-tabs__link> Guides </a> </li> <li class=md-tabs__item> <a href=../ class=md-tabs__link> Architecture </a> </li> <li class=md-tabs__item> <a href=../../contributing/ class=md-tabs__link> Contributing </a> </li> <li class=md-tabs__item> <a href=../../guides/troubleshooting/ class=md-tabs__link> Troubleshooting </a> </li> <li class=md-tabs__item> <a href=../../changelog/ class=md-tabs__link> Changelog </a> </li> </ul> </div> </nav> </header> <div class=md-container data-md-component=container> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=sidebar data-md-type=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=../.. title=Assay class="md-nav__button md-logo" aria-label=Assay data-md-component=logo> <img src=../../assets/logo.svg alt=logo> </a> Assay </label> <div class=md-nav__source> <a href=https://github.com/Rul1an/assay title="Go to repository" class=md-source data-md-component=source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </div> <div class=md-source__repository> Rul1an/assay </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../.. class=md-nav__link> <span class=md-ellipsis> Home </span> </a> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_2> <label class=md-nav__link for=__nav_2 id=__nav_2_label tabindex=0> <span class=md-ellipsis> Getting Started </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_2_label aria-expanded=false> <label class=md-nav__title for=__nav_2> <span class="md-nav__icon md-icon"></span> Getting Started </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../getting-started/ class=md-nav__link> <span class=md-ellipsis> Getting Started </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/installation/ class=md-nav__link> <span class=md-ellipsis> Installation </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/quickstart/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/first-test/ class=md-nav__link> <span class=md-ellipsis> Your First Test </span> </a> </li> <li class=md-nav__item> <a href=../../getting-started/ci-integration/ class=md-nav__link> <span class=md-ellipsis> CI Integration </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_3> <label class=md-nav__link for=__nav_3 id=__nav_3_label tabindex=0> <span class=md-ellipsis> Core Concepts </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_3_label aria-expanded=false> <label class=md-nav__title for=__nav_3> <span class="md-nav__icon md-icon"></span> Core Concepts </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../concepts/ class=md-nav__link> <span class=md-ellipsis> Core Concepts </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/traces/ class=md-nav__link> <span class=md-ellipsis> Traces </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/policies/ class=md-nav__link> <span class=md-ellipsis> Policies </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/metrics/ class=md-nav__link> <span class=md-ellipsis> Metrics </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/replay/ class=md-nav__link> <span class=md-ellipsis> Replay Engine </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/cache/ class=md-nav__link> <span class=md-ellipsis> Cache & Fingerprints </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/scope/ class=md-nav__link> <span class=md-ellipsis> Scope & Boundaries </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/fail-safe/ class=md-nav__link> <span class=md-ellipsis> Fail-Safe Config </span> </a> </li> <li class=md-nav__item> <a href=../../concepts/pack-registry/ class=md-nav__link> <span class=md-ellipsis> Pack Registry </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_4> <label class=md-nav__link for=__nav_4 id=__nav_4_label tabindex=0> <span class=md-ellipsis> Python SDK </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_4_label aria-expanded=false> <label class=md-nav__title for=__nav_4> <span class="md-nav__icon md-icon"></span> Python SDK </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../python-sdk/ class=md-nav__link> <span class=md-ellipsis> Python SDK </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_5> <label class=md-nav__link for=__nav_5 id=__nav_5_label tabindex=0> <span class=md-ellipsis> MCP Integration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_5_label aria-expanded=false> <label class=md-nav__title for=__nav_5> <span class="md-nav__icon md-icon"></span> MCP Integration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../mcp/ class=md-nav__link> <span class=md-ellipsis> MCP Integration </span> </a> </li> <li class=md-nav__item> <a href=../../mcp/quickstart/ class=md-nav__link> <span class=md-ellipsis> Quick Start </span> </a> </li> <li class=md-nav__item> <a href=../../mcp/import-formats/ class=md-nav__link> <span class=md-ellipsis> Import Formats </span> </a> </li> <li class=md-nav__item> <a href=../../mcp/server/ class=md-nav__link> <span class=md-ellipsis> Assay MCP Server </span> </a> </li> <li class=md-nav__item> <a href=../../mcp/self-correction/ class=md-nav__link> <span class=md-ellipsis> Self-Correcting Agents </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_6> <label class=md-nav__link for=__nav_6 id=__nav_6_label tabindex=0> <span class=md-ellipsis> Configuration </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_6_label aria-expanded=false> <label class=md-nav__title for=__nav_6> <span class="md-nav__icon md-icon"></span> Configuration </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/config/ class=md-nav__link> <span class=md-ellipsis> Configuration </span> </a> </li> <li class=md-nav__item> <a href=../../reference/config/eval-yaml/ class=md-nav__link> <span class=md-ellipsis> mcp-eval.yaml </span> </a> </li> <li class=md-nav__item> <a href=../../reference/config/policies/ class=md-nav__link> <span class=md-ellipsis> Policy Files </span> </a> </li> <li class=md-nav__item> <a href=../../reference/sandbox-policies/ class=md-nav__link> <span class=md-ellipsis> Sandbox Policies </span> </a> </li> <li class=md-nav__item> <a href=../../reference/sandbox-env/ class=md-nav__link> <span class=md-ellipsis> Environment Filtering </span> </a> </li> <li class=md-nav__item> <a href=../../reference/config/sequences/ class=md-nav__link> <span class=md-ellipsis> Sequence Rules DSL </span> </a> </li> <li class=md-nav__item> <a href=../../reference/config/migration/ class=md-nav__link> <span class=md-ellipsis> Migration Guide </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_7> <label class=md-nav__link for=__nav_7 id=__nav_7_label tabindex=0> <span class=md-ellipsis> CLI Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_7_label aria-expanded=false> <label class=md-nav__title for=__nav_7> <span class="md-nav__icon md-icon"></span> CLI Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../reference/cli/ class=md-nav__link> <span class=md-ellipsis> CLI Reference </span> </a> </li> <li class=md-nav__item> <a href=../../reference/cli/init/ class=md-nav__link> <span class=md-ellipsis> assay init </span> </a> </li> <li class=md-nav__item> <a href=../../reference/cli/validate/ class=md-nav__link> <span class=md-ellipsis> assay validate </span> </a> </li> <li class=md-nav__item> <a href=../../reference/cli/run/ class=md-nav__link> <span class=md-ellipsis> assay run </span> </a> </li> <li class=md-nav__item> <a href=../../reference/cli/generate/ class=md-nav__link> <span class=md-ellipsis> assay generate </span> </a> </li> <li class=md-nav__item> <a href=../../reference/cli/explain/ class=md-nav__link> <span class=md-ellipsis> assay explain </span> </a> </li> <li class=md-nav__item> <a href=../../reference/cli/doctor/ class=md-nav__link> <span class=md-ellipsis> assay doctor </span> </a> </li> <li class=md-nav__item> <a href=../../reference/cli/watch/ class=md-nav__link> <span class=md-ellipsis> assay watch </span> </a> </li> <li class=md-nav__item> <a href=../../reference/cli/sandbox/ class=md-nav__link> <span class=md-ellipsis> assay sandbox </span> </a> </li> <li class=md-nav__item> <a href=../../reference/cli/import/ class=md-nav__link> <span class=md-ellipsis> assay import </span> </a> </li> <li class=md-nav__item> <a href=../../reference/cli/migrate/ class=md-nav__link> <span class=md-ellipsis> assay migrate </span> </a> </li> <li class=md-nav__item> <a href=../../reference/cli/replay/ class=md-nav__link> <span class=md-ellipsis> assay replay </span> </a> </li> <li class=md-nav__item> <a href=../../reference/cli/mcp-server/ class=md-nav__link> <span class=md-ellipsis> assay mcp-server </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_8> <label class=md-nav__link for=__nav_8 id=__nav_8_label tabindex=0> <span class=md-ellipsis> Metrics Reference </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_8_label aria-expanded=false> <label class=md-nav__title for=__nav_8> <span class="md-nav__icon md-icon"></span> Metrics Reference </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../metrics/ class=md-nav__link> <span class=md-ellipsis> Assertion Types (V1) </span> </a> </li> <li class=md-nav__item> <a href=../../metrics/args-valid/ class=md-nav__link> <span class=md-ellipsis> args_valid </span> </a> </li> <li class=md-nav__item> <a href=../../metrics/sequence-valid/ class=md-nav__link> <span class=md-ellipsis> sequence_valid </span> </a> </li> <li class=md-nav__item> <a href=../../metrics/tool-blocklist/ class=md-nav__link> <span class=md-ellipsis> tool_blocklist </span> </a> </li> <li class=md-nav__item> <a href=../../metrics/custom/ class=md-nav__link> <span class=md-ellipsis> Custom Metrics </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_9> <label class=md-nav__link for=__nav_9 id=__nav_9_label tabindex=0> <span class=md-ellipsis> Use Cases </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_9_label aria-expanded=false> <label class=md-nav__title for=__nav_9> <span class="md-nav__icon md-icon"></span> Use Cases </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../use-cases/ class=md-nav__link> <span class=md-ellipsis> Use Cases </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/ci-gate/ class=md-nav__link> <span class=md-ellipsis> CI Regression Gate </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/debugging/ class=md-nav__link> <span class=md-ellipsis> Trace-Driven Debugging </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/air-gapped/ class=md-nav__link> <span class=md-ellipsis> Air-Gapped Enterprise </span> </a> </li> <li class=md-nav__item> <a href=../../use-cases/self-correction/ class=md-nav__link> <span class=md-ellipsis> Agent Self-Correction </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_10> <label class=md-nav__link for=__nav_10 id=__nav_10_label tabindex=0> <span class=md-ellipsis> Guides </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_10_label aria-expanded=false> <label class=md-nav__title for=__nav_10> <span class="md-nav__icon md-icon"></span> Guides </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../guides/ class=md-nav__link> <span class=md-ellipsis> Guides </span> </a> </li> <li class=md-nav__item> <a href=../../guides/sandbox-security/ class=md-nav__link> <span class=md-ellipsis> Sandbox Security </span> </a> </li> <li class=md-nav__item> <a href=../../guides/gateway-pattern/ class=md-nav__link> <span class=md-ellipsis> Gateway Pattern </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_11> <label class=md-nav__link for=__nav_11 id=__nav_11_label tabindex=0> <span class=md-ellipsis> Architecture </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_11_label aria-expanded=false> <label class=md-nav__title for=__nav_11> <span class="md-nav__icon md-icon"></span> Architecture </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../ class=md-nav__link> <span class=md-ellipsis> Architecture </span> </a> </li> <li class=md-nav__item> <a href=../crates/ class=md-nav__link> <span class=md-ellipsis> Crate Structure </span> </a> </li> <li class=md-nav__item> <a href=../data-flow/ class=md-nav__link> <span class=md-ellipsis> Data Flow </span> </a> </li> <li class=md-nav__item> <a href=../../PERFORMANCE-BUDGETS/ class=md-nav__link> <span class=md-ellipsis> Performance Budgets </span> </a> </li> <li class=md-nav__item> <a href=../adrs/ class=md-nav__link> <span class=md-ellipsis> ADRs </span> </a> </li> </ul> </nav> </li> <li class="md-nav__item md-nav__item--nested"> <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type=checkbox id=__nav_12> <label class=md-nav__link for=__nav_12 id=__nav_12_label tabindex=0> <span class=md-ellipsis> Contributing </span> <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav data-md-level=1 aria-labelledby=__nav_12_label aria-expanded=false> <label class=md-nav__title for=__nav_12> <span class="md-nav__icon md-icon"></span> Contributing </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=../../contributing/ class=md-nav__link> <span class=md-ellipsis> Contributing </span> </a> </li> <li class=md-nav__item> <a href=../../contributing/setup/ class=md-nav__link> <span class=md-ellipsis> Development Setup </span> </a> </li> <li class=md-nav__item> <a href=../../contributing/metrics/ class=md-nav__link> <span class=md-ellipsis> Adding Metrics </span> </a> </li> <li class=md-nav__item> <a href=../../contributing/releases/ class=md-nav__link> <span class=md-ellipsis> Release Process </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../../guides/troubleshooting/ class=md-nav__link> <span class=md-ellipsis> Troubleshooting </span> </a> </li> <li class=md-nav__item> <a href=../../changelog/ class=md-nav__link> <span class=md-ellipsis> Changelog </span> </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=sidebar data-md-type=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-component=toc data-md-scrollfix> <li class=md-nav__item> <a href=#abstract class=md-nav__link> <span class=md-ellipsis> Abstract </span> </a> </li> <li class=md-nav__item> <a href=#1-scope class=md-nav__link> <span class=md-ellipsis> 1. Scope </span> </a> <nav class=md-nav aria-label="1. Scope"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#11-in-scope class=md-nav__link> <span class=md-ellipsis> 1.1 In Scope </span> </a> </li> <li class=md-nav__item> <a href=#12-out-of-scope class=md-nav__link> <span class=md-ellipsis> 1.2 Out of Scope </span> </a> </li> <li class=md-nav__item> <a href=#13-changelog class=md-nav__link> <span class=md-ellipsis> 1.3 Changelog </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#2-pack-resolution-order-informative-summary class=md-nav__link> <span class=md-ellipsis> 2. Pack Resolution Order (Informative Summary) </span> </a> </li> <li class=md-nav__item> <a href=#3-pack-reference-format class=md-nav__link> <span class=md-ellipsis> 3. Pack Reference Format </span> </a> </li> <li class=md-nav__item> <a href=#4-registry-api-contract class=md-nav__link> <span class=md-ellipsis> 4. Registry API Contract </span> </a> <nav class=md-nav aria-label="4. Registry API Contract"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#41-base-url class=md-nav__link> <span class=md-ellipsis> 4.1 Base URL </span> </a> </li> <li class=md-nav__item> <a href=#42-namespaces class=md-nav__link> <span class=md-ellipsis> 4.2 Namespaces </span> </a> </li> <li class=md-nav__item> <a href=#43-endpoints class=md-nav__link> <span class=md-ellipsis> 4.3 Endpoints </span> </a> <nav class=md-nav aria-label="4.3 Endpoints"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#get-packsnameversion class=md-nav__link> <span class=md-ellipsis> GET /packs/{name}/{version} </span> </a> </li> <li class=md-nav__item> <a href=#head-packsnameversion class=md-nav__link> <span class=md-ellipsis> HEAD /packs/{name}/{version} </span> </a> </li> <li class=md-nav__item> <a href=#get-packsnameversions class=md-nav__link> <span class=md-ellipsis> GET /packs/{name}/versions </span> </a> </li> <li class=md-nav__item> <a href=#get-packs class=md-nav__link> <span class=md-ellipsis> GET /packs </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#44-rate-limiting class=md-nav__link> <span class=md-ellipsis> 4.4 Rate Limiting </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#5-authentication class=md-nav__link> <span class=md-ellipsis> 5. Authentication </span> </a> <nav class=md-nav aria-label="5. Authentication"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#51-token-authentication class=md-nav__link> <span class=md-ellipsis> 5.1 Token Authentication </span> </a> </li> <li class=md-nav__item> <a href=#52-oidc-authentication-github-actions class=md-nav__link> <span class=md-ellipsis> 5.2 OIDC Authentication (GitHub Actions) </span> </a> <nav class=md-nav aria-label="5.2 OIDC Authentication (GitHub Actions)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#521-token-exchange-flow-normative class=md-nav__link> <span class=md-ellipsis> 5.2.1 Token Exchange Flow (NORMATIVE) </span> </a> </li> <li class=md-nav__item> <a href=#522-exchange-endpoint class=md-nav__link> <span class=md-ellipsis> 5.2.2 Exchange Endpoint </span> </a> </li> <li class=md-nav__item> <a href=#523-github-actions-example class=md-nav__link> <span class=md-ellipsis> 5.2.3 GitHub Actions Example </span> </a> </li> <li class=md-nav__item> <a href=#524-registry-oidc-configuration class=md-nav__link> <span class=md-ellipsis> 5.2.4 Registry OIDC Configuration </span> </a> </li> <li class=md-nav__item> <a href=#525-token-handling class=md-nav__link> <span class=md-ellipsis> 5.2.5 Token Handling </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#53-no-authentication-open-packs class=md-nav__link> <span class=md-ellipsis> 5.3 No Authentication (Open Packs) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#6-integrity-verification class=md-nav__link> <span class=md-ellipsis> 6. Integrity Verification </span> </a> <nav class=md-nav aria-label="6. Integrity Verification"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#61-pack-canonical-form-normative class=md-nav__link> <span class=md-ellipsis> 6.1 Pack Canonical Form (NORMATIVE) </span> </a> </li> <li class=md-nav__item> <a href=#62-digest-verification-normative class=md-nav__link> <span class=md-ellipsis> 6.2 Digest Verification (NORMATIVE) </span> </a> </li> <li class=md-nav__item> <a href=#63-signature-verification-normative class=md-nav__link> <span class=md-ellipsis> 6.3 Signature Verification (NORMATIVE) </span> </a> <nav class=md-nav aria-label="6.3 Signature Verification (NORMATIVE)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#631-dsse-envelope-format-normative class=md-nav__link> <span class=md-ellipsis> 6.3.1 DSSE Envelope Format (NORMATIVE) </span> </a> </li> <li class=md-nav__item> <a href=#632-verification-flow class=md-nav__link> <span class=md-ellipsis> 6.3.2 Verification Flow </span> </a> </li> <li class=md-nav__item> <a href=#633-signature-sidecar-endpoint-recommended class=md-nav__link> <span class=md-ellipsis> 6.3.3 Signature Sidecar Endpoint (RECOMMENDED) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#64-key-trust-model-normative class=md-nav__link> <span class=md-ellipsis> 6.4 Key Trust Model (NORMATIVE) </span> </a> <nav class=md-nav aria-label="6.4 Key Trust Model (NORMATIVE)"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#641-trust-roots-normative class=md-nav__link> <span class=md-ellipsis> 6.4.1 Trust Roots (NORMATIVE) </span> </a> </li> <li class=md-nav__item> <a href=#642-keys-manifest class=md-nav__link> <span class=md-ellipsis> 6.4.2 Keys Manifest </span> </a> </li> <li class=md-nav__item> <a href=#643-trust-hierarchy class=md-nav__link> <span class=md-ellipsis> 6.4.3 Trust Hierarchy </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#65-keyless-signing-future class=md-nav__link> <span class=md-ellipsis> 6.5 Keyless Signing (Future) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#7-caching class=md-nav__link> <span class=md-ellipsis> 7. Caching </span> </a> <nav class=md-nav aria-label="7. Caching"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#71-local-cache class=md-nav__link> <span class=md-ellipsis> 7.1 Local Cache </span> </a> </li> <li class=md-nav__item> <a href=#72-cache-integrity-verification-normative class=md-nav__link> <span class=md-ellipsis> 7.2 Cache Integrity Verification (NORMATIVE) </span> </a> </li> <li class=md-nav__item> <a href=#73-cache-invalidation class=md-nav__link> <span class=md-ellipsis> 7.3 Cache Invalidation </span> </a> </li> <li class=md-nav__item> <a href=#74-cache-ttl class=md-nav__link> <span class=md-ellipsis> 7.4 Cache TTL </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#8-lockfile class=md-nav__link> <span class=md-ellipsis> 8. Lockfile </span> </a> <nav class=md-nav aria-label="8. Lockfile"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#81-purpose class=md-nav__link> <span class=md-ellipsis> 8.1 Purpose </span> </a> </li> <li class=md-nav__item> <a href=#82-lockfile-format class=md-nav__link> <span class=md-ellipsis> 8.2 Lockfile Format </span> </a> </li> <li class=md-nav__item> <a href=#83-cli-commands class=md-nav__link> <span class=md-ellipsis> 8.3 CLI Commands </span> </a> </li> <li class=md-nav__item> <a href=#84-lockfile-behavior class=md-nav__link> <span class=md-ellipsis> 8.4 Lockfile Behavior </span> </a> </li> <li class=md-nav__item> <a href=#85-ci-integration class=md-nav__link> <span class=md-ellipsis> 8.5 CI Integration </span> </a> </li> <li class=md-nav__item> <a href=#86-security-revocation-handling class=md-nav__link> <span class=md-ellipsis> 8.6 Security Revocation Handling </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#9-byos-pack-storage class=md-nav__link> <span class=md-ellipsis> 9. BYOS Pack Storage </span> </a> </li> <li class=md-nav__item> <a href=#10-error-messages class=md-nav__link> <span class=md-ellipsis> 10. Error Messages </span> </a> <nav class=md-nav aria-label="10. Error Messages"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#101-user-facing-errors class=md-nav__link> <span class=md-ellipsis> 10.1 User-Facing Errors </span> </a> </li> <li class=md-nav__item> <a href=#102-github-action-error class=md-nav__link> <span class=md-ellipsis> 10.2 GitHub Action Error </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#11-cli-implementation class=md-nav__link> <span class=md-ellipsis> 11. CLI Implementation </span> </a> <nav class=md-nav aria-label="11. CLI Implementation"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#111-config-commands class=md-nav__link> <span class=md-ellipsis> 11.1 Config Commands </span> </a> </li> <li class=md-nav__item> <a href=#112-fetch-command-optional class=md-nav__link> <span class=md-ellipsis> 11.2 Fetch Command (Optional) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#12-security-considerations class=md-nav__link> <span class=md-ellipsis> 12. Security Considerations </span> </a> <nav class=md-nav aria-label="12. Security Considerations"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#121-token-security class=md-nav__link> <span class=md-ellipsis> 12.1 Token Security </span> </a> </li> <li class=md-nav__item> <a href=#122-mitm-protection class=md-nav__link> <span class=md-ellipsis> 12.2 MITM Protection </span> </a> </li> <li class=md-nav__item> <a href=#123-supply-chain class=md-nav__link> <span class=md-ellipsis> 12.3 Supply Chain </span> </a> </li> <li class=md-nav__item> <a href=#124-yaml-parsing-security class=md-nav__link> <span class=md-ellipsis> 12.4 YAML Parsing Security </span> </a> </li> <li class=md-nav__item> <a href=#125-size-limits class=md-nav__link> <span class=md-ellipsis> 12.5 Size Limits </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#13-future-oci-distribution class=md-nav__link> <span class=md-ellipsis> 13. Future: OCI Distribution </span> </a> <nav class=md-nav aria-label="13. Future: OCI Distribution"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#131-rationale class=md-nav__link> <span class=md-ellipsis> 13.1 Rationale </span> </a> </li> <li class=md-nav__item> <a href=#132-planned-support-v11 class=md-nav__link> <span class=md-ellipsis> 13.2 Planned Support (v1.1) </span> </a> </li> <li class=md-nav__item> <a href=#133-digest-mapping class=md-nav__link> <span class=md-ellipsis> 13.3 Digest Mapping </span> </a> </li> <li class=md-nav__item> <a href=#134-ci-best-practice class=md-nav__link> <span class=md-ellipsis> 13.4 CI Best Practice </span> </a> </li> <li class=md-nav__item> <a href=#135-coexistence class=md-nav__link> <span class=md-ellipsis> 13.5 Coexistence </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#14-implementation-checklist class=md-nav__link> <span class=md-ellipsis> 14. Implementation Checklist </span> </a> <nav class=md-nav aria-label="14. Implementation Checklist"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#phase-1-v10 class=md-nav__link> <span class=md-ellipsis> Phase 1 (v1.0) </span> </a> </li> <li class=md-nav__item> <a href=#phase-2-v11 class=md-nav__link> <span class=md-ellipsis> Phase 2 (v1.1) </span> </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=#15-references class=md-nav__link> <span class=md-ellipsis> 15. References </span> </a> <nav class=md-nav aria-label="15. References"> <ul class=md-nav__list> <li class=md-nav__item> <a href=#normative class=md-nav__link> <span class=md-ellipsis> Normative </span> </a> </li> <li class=md-nav__item> <a href=#informative class=md-nav__link> <span class=md-ellipsis> Informative </span> </a> </li> </ul> </nav> </li> </ul> </nav> </div> </div> </div> <div class=md-content data-md-component=content> <article class="md-content__inner md-typeset"> <h1 id=spec-pack-registry-v1>SPEC-Pack-Registry-v1<a class=headerlink href=#spec-pack-registry-v1 title="Permanent link">&para;</a></h1> <p><strong>Version:</strong> 1.0.5 <strong>Status:</strong> Draft <strong>Date:</strong> 2026-02-06 <strong>Related:</strong> <a href=../ADR-016-Pack-Taxonomy/ >ADR-016</a>, <a href=../ADR-021-Local-Pack-Discovery/ >ADR-021</a>, <a href=../SPEC-Pack-Engine-v1/ >SPEC-Pack-Engine-v1</a></p> <h2 id=abstract>Abstract<a class=headerlink href=#abstract title="Permanent link">&para;</a></h2> <p>This specification defines the pack registry protocol for resolving and fetching compliance packs from remote sources. It enables enterprise pack distribution without including commercial content in the open source repository.</p> <hr> <h2 id=1-scope>1. Scope<a class=headerlink href=#1-scope title="Permanent link">&para;</a></h2> <h3 id=11-in-scope>1.1 In Scope<a class=headerlink href=#11-in-scope title="Permanent link">&para;</a></h3> <ul> <li>Pack resolution order (normative order in <a href=../SPEC-Pack-Engine-v1/#pack-resolution-normative>SPEC-Pack-Engine-v1</a>: path → built-in → local config dir → registry → BYOS)</li> <li>Registry HTTP API contract</li> <li>Authentication (OIDC token exchange, static token)</li> <li>Integrity verification (digest + signature)</li> <li>Pack canonicalization (strict YAML subset)</li> <li>Key trust model</li> <li>Caching behavior</li> <li>Lockfile format</li> </ul> <h3 id=12-out-of-scope>1.2 Out of Scope<a class=headerlink href=#12-out-of-scope title="Permanent link">&para;</a></h3> <ul> <li>Pack content/rules (see SPEC-Pack-Engine-v1)</li> <li>Registry hosting implementation</li> <li>Billing/licensing enforcement</li> </ul> <h3 id=13-changelog>1.3 Changelog<a class=headerlink href=#13-changelog title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Version</th> <th>Changes</th> </tr> </thead> <tbody> <tr> <td>1.0.5</td> <td><strong>Interop polish:</strong> Content-Digest defined over decoded body (after content-coding); <code>X-Pack-Policy: commercial|open</code> header for signature requirement (client classifies from header, not body); canonical bytes = UTF-8, no BOM, no trailing newline; trust roots default = union, override only via explicit config; keys manifest payloadType MUST <code>application/vnd.assay.registry.keys.v1+json</code>, payload = raw JSON; pack_name grammar link to Engine spec; commercial schema evolution (additive = breaking unless schema version); BYOS <code>x-assay-sig</code> spelling; OCI = additional resolver class; media type <code>application/x-yaml</code> canonical; cache metadata <code>policy</code></td> </tr> <tr> <td>1.0.4</td> <td><strong>Normative and consistency fixes:</strong> §2 informative; fail-fast (no match vs matched-but-failed); commercial signature required + sidecar 404; ETag/Content-Digest; trust hierarchy; keys manifest payloadType; cache path registry/namespace; duplicate-key reject; path_ref/BYOS pin; 410 CI; lockfile v2 Phase 1; §6.3.3 + sidecar path</td> </tr> <tr> <td>1.0.3</td> <td><strong>Sidecar signature endpoint</strong> (§6.3.3) to avoid header size limits; detached DSSE envelope; signature now separate from pack body; backward-compatible with in-header signatures</td> </tr> <tr> <td>1.0.2</td> <td>OIDC token exchange endpoint, DSSE envelope format, Content-Digest (RFC 9530), Vary header, key trust manifest, number policy, HEAD endpoint, cache integrity verification, lockfile extensions, 410 handling</td> </tr> <tr> <td>1.0.1</td> <td>Add signature verification (MUST for commercial), strict canonicalization, lockfile, ETag/304, pagination, rate limits, OCI future track</td> </tr> <tr> <td>1.0.0</td> <td>Initial specification</td> </tr> </tbody> </table> <hr> <h2 id=2-pack-resolution-order-informative-summary>2. Pack Resolution Order (Informative Summary)<a class=headerlink href=#2-pack-resolution-order-informative-summary title="Permanent link">&para;</a></h2> <p>The <strong>normative</strong> pack resolution order is defined in <a href=../SPEC-Pack-Engine-v1/#pack-resolution-normative>SPEC-Pack-Engine-v1 § Pack Resolution (Normative)</a>. This section is an informative summary only.</p> <ol> <li><strong>Path</strong> — Existing file or directory (if dir: load <code>&lt;dir&gt;/pack.yaml</code>).</li> <li><strong>Built-in</strong> — By name (e.g. <code>eu-ai-act-baseline</code>); built-in wins over local config dir.</li> <li><strong>Local pack directory</strong> — Config dir (<code>~/.config/assay/packs</code> / <code>%APPDATA%\assay\packs</code>); <code>{name}.yaml</code> or <code>{name}/pack.yaml</code>.</li> <li><strong>Registry</strong> — <code>name@version</code> or pinned <code>name@version#sha256:...</code> (this SPEC).</li> <li><strong>BYOS</strong> — <code>s3://</code>, <code>gs://</code>, <code>az://</code>, etc.</li> <li><strong>NotFound</strong> — Error with suggestion.</li> </ol> <p><strong>Resolution semantics (NORMATIVE; see SPEC-Pack-Engine-v1 for full wording):</strong></p> <ul> <li><strong>No match</strong> — If the reference does not match the current step (e.g. not a path, not a built-in name), the resolver MUST continue to the next step. No error at this step.</li> <li><strong>Matched but failed</strong> — If a step <em>does</em> match (e.g. registry ref, fetch succeeded) but verification fails (digest mismatch, signature missing/invalid for commercial, 410 revoked without opt-in), the client MUST fail immediately with a clear error. No fallback to a later step.</li> <li>Example: <code>name@version#sha256:...</code> resolved via registry → fetch OK but digest mismatch → hard error (do not try BYOS). Example: path exists but file unreadable → error at path step (do not continue).</li> </ul> <hr> <h2 id=3-pack-reference-format>3. Pack Reference Format<a class=headerlink href=#3-pack-reference-format title="Permanent link">&para;</a></h2> <div class="language-text highlight"><pre><span></span><code><span id=__span-0-1><a id=__codelineno-0-1 name=__codelineno-0-1 href=#__codelineno-0-1></a>pack_ref := path_ref | bundled_name | registry_ref | pinned_ref | byos_ref
</span><span id=__span-0-2><a id=__codelineno-0-2 name=__codelineno-0-2 href=#__codelineno-0-2></a>
</span><span id=__span-0-3><a id=__codelineno-0-3 name=__codelineno-0-3 href=#__codelineno-0-3></a>path_ref      := filesystem path (file or directory)
</span><span id=__span-0-4><a id=__codelineno-0-4 name=__codelineno-0-4 href=#__codelineno-0-4></a>                 # File: .yaml/.yml or arbitrary; directory: must contain pack.yaml (per SPEC-Pack-Engine-v1)
</span><span id=__span-0-5><a id=__codelineno-0-5 name=__codelineno-0-5 href=#__codelineno-0-5></a>                 # May be relative (./packs/foo.yaml, ../bar.yaml) or absolute (/path/to/pack.yaml, C:\...)
</span><span id=__span-0-6><a id=__codelineno-0-6 name=__codelineno-0-6 href=#__codelineno-0-6></a>bundled_name  := pack_name    # pack_name as in SPEC-Pack-Engine-v1 (lowercase letters, digits, hyphens only; no underscores/dots)
</span><span id=__span-0-7><a id=__codelineno-0-7 name=__codelineno-0-7 href=#__codelineno-0-7></a>registry_ref  := pack_name &quot;@&quot; version        # e.g., &quot;eu-ai-act-pro@1.2.0&quot;
</span><span id=__span-0-8><a id=__codelineno-0-8 name=__codelineno-0-8 href=#__codelineno-0-8></a>pinned_ref    := pack_name &quot;@&quot; version &quot;#&quot; digest  # digest = canonical sha256 (same as X-Pack-Digest / lockfile)
</span><span id=__span-0-9><a id=__codelineno-0-9 name=__codelineno-0-9 href=#__codelineno-0-9></a>byos_ref      := scheme &quot;://&quot; path [ &quot;#&quot; digest ]   # e.g., &quot;s3://bucket/packs/custom.yaml&quot; or &quot;...custom.yaml#sha256:...&quot;
</span></code></pre></div> <p><strong>Path references:</strong> Resolution of path refs (file vs directory, containment) is normative in <a href=../SPEC-Pack-Engine-v1/#pack-resolution-normative>SPEC-Pack-Engine-v1</a>. <strong>Pack name</strong> (<code>pack_name</code>) grammar is defined in <a href=../SPEC-Pack-Engine-v1/#pack-name-grammar-normative>SPEC-Pack-Engine-v1 § Pack name grammar</a> and used consistently for bundled names, local config dir names, and registry names; do not define a different grammar here.</p> <p><strong>Version requirement</strong>: Registry refs MUST include version. <code>@latest</code> is NOT supported for reproducibility.</p> <p><strong>Pinned refs (RECOMMENDED for CI)</strong>: Include digest for double-verification:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-1-1><a id=__codelineno-1-1 name=__codelineno-1-1 href=#__codelineno-1-1></a><span class=c1># Pinned ref with digest</span>
</span><span id=__span-1-2><a id=__codelineno-1-2 name=__codelineno-1-2 href=#__codelineno-1-2></a>assay<span class=w> </span>evidence<span class=w> </span>lint<span class=w> </span>--pack<span class=w> </span><span class=s2>&quot;eu-ai-act-pro@1.2.0#sha256:abc123...&quot;</span><span class=w> </span>bundle.tar.gz
</span></code></pre></div> <p>When digest is specified, CLI MUST verify fetched content matches before use.</p> <hr> <h2 id=4-registry-api-contract>4. Registry API Contract<a class=headerlink href=#4-registry-api-contract title="Permanent link">&para;</a></h2> <h3 id=41-base-url>4.1 Base URL<a class=headerlink href=#41-base-url title="Permanent link">&para;</a></h3> <div class="language-text highlight"><pre><span></span><code><span id=__span-2-1><a id=__codelineno-2-1 name=__codelineno-2-1 href=#__codelineno-2-1></a>Default: https://registry.getassay.dev/v1
</span><span id=__span-2-2><a id=__codelineno-2-2 name=__codelineno-2-2 href=#__codelineno-2-2></a>Override: ASSAY_REGISTRY_URL environment variable
</span></code></pre></div> <h3 id=42-namespaces>4.2 Namespaces<a class=headerlink href=#42-namespaces title="Permanent link">&para;</a></h3> <p>Packs MAY be namespaced for multi-tenant access control:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-3-1><a id=__codelineno-3-1 name=__codelineno-3-1 href=#__codelineno-3-1></a>/packs/{name}/{version}                    # Global namespace
</span><span id=__span-3-2><a id=__codelineno-3-2 name=__codelineno-3-2 href=#__codelineno-3-2></a>/orgs/{org}/packs/{name}/{version}         # Organization namespace
</span></code></pre></div> <p><strong>Authorization</strong>: Organization packs require membership in the org.</p> <h3 id=43-endpoints>4.3 Endpoints<a class=headerlink href=#43-endpoints title="Permanent link">&para;</a></h3> <h4 id=get-packsnameversion>GET /packs/{name}/{version}<a class=headerlink href=#get-packsnameversion title="Permanent link">&para;</a></h4> <p>Fetch pack content.</p> <p><strong>Request:</strong></p> <div class="language-http highlight"><pre><span></span><code><span id=__span-4-1><a id=__codelineno-4-1 name=__codelineno-4-1 href=#__codelineno-4-1></a><span class=nf>GET</span> <span class=nn>/packs/eu-ai-act-pro/1.2.0</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span><span id=__span-4-2><a id=__codelineno-4-2 name=__codelineno-4-2 href=#__codelineno-4-2></a><span class=na>Host</span><span class=o>:</span> <span class=l>registry.getassay.dev</span>
</span><span id=__span-4-3><a id=__codelineno-4-3 name=__codelineno-4-3 href=#__codelineno-4-3></a><span class=na>Authorization</span><span class=o>:</span> <span class=l>Bearer &lt;token&gt;</span>
</span><span id=__span-4-4><a id=__codelineno-4-4 name=__codelineno-4-4 href=#__codelineno-4-4></a><span class=na>Accept</span><span class=o>:</span> <span class=l>application/x-yaml</span>
</span><span id=__span-4-5><a id=__codelineno-4-5 name=__codelineno-4-5 href=#__codelineno-4-5></a><span class=na>Accept-Encoding</span><span class=o>:</span> <span class=l>gzip</span>
</span><span id=__span-4-6><a id=__codelineno-4-6 name=__codelineno-4-6 href=#__codelineno-4-6></a><span class=na>If-None-Match</span><span class=o>:</span> <span class=l>&quot;sha256:abc123...&quot;</span>
</span></code></pre></div> <p><strong>Response (200 OK):</strong></p> <div class="language-http highlight"><pre><span></span><code><span id=__span-5-1><a id=__codelineno-5-1 name=__codelineno-5-1 href=#__codelineno-5-1></a><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
</span><span id=__span-5-2><a id=__codelineno-5-2 name=__codelineno-5-2 href=#__codelineno-5-2></a><span class=na>Content-Type</span><span class=o>:</span> <span class=l>application/x-yaml</span>
</span><span id=__span-5-3><a id=__codelineno-5-3 name=__codelineno-5-3 href=#__codelineno-5-3></a><span class=na>ETag</span><span class=o>:</span> <span class=l>&quot;sha256:abc123...&quot;</span>
</span><span id=__span-5-4><a id=__codelineno-5-4 name=__codelineno-5-4 href=#__codelineno-5-4></a><span class=na>Content-Digest</span><span class=o>:</span> <span class=l>sha-256=:base64digest...:</span>
</span><span id=__span-5-5><a id=__codelineno-5-5 name=__codelineno-5-5 href=#__codelineno-5-5></a><span class=na>X-Pack-Digest</span><span class=o>:</span> <span class=l>sha256:abc123...</span>
</span><span id=__span-5-6><a id=__codelineno-5-6 name=__codelineno-5-6 href=#__codelineno-5-6></a><span class=na>X-Pack-Signature</span><span class=o>:</span> <span class=l>&lt;base64-encoded-DSSE-envelope&gt;</span>
</span><span id=__span-5-7><a id=__codelineno-5-7 name=__codelineno-5-7 href=#__codelineno-5-7></a><span class=na>X-Pack-Key-Id</span><span class=o>:</span> <span class=l>sha256:def456...</span>
</span><span id=__span-5-8><a id=__codelineno-5-8 name=__codelineno-5-8 href=#__codelineno-5-8></a><span class=na>X-Pack-Policy</span><span class=o>:</span> <span class=l>commercial</span>
</span><span id=__span-5-9><a id=__codelineno-5-9 name=__codelineno-5-9 href=#__codelineno-5-9></a><span class=na>X-Pack-License</span><span class=o>:</span> <span class=l>LicenseRef-Assay-Enterprise-1.0</span>
</span><span id=__span-5-10><a id=__codelineno-5-10 name=__codelineno-5-10 href=#__codelineno-5-10></a><span class=na>Cache-Control</span><span class=o>:</span> <span class=l>private, max-age=86400</span>
</span><span id=__span-5-11><a id=__codelineno-5-11 name=__codelineno-5-11 href=#__codelineno-5-11></a><span class=na>Vary</span><span class=o>:</span> <span class=l>Authorization, Accept-Encoding</span>
</span><span id=__span-5-12><a id=__codelineno-5-12 name=__codelineno-5-12 href=#__codelineno-5-12></a>
</span><span id=__span-5-13><a id=__codelineno-5-13 name=__codelineno-5-13 href=#__codelineno-5-13></a>name: eu-ai-act-pro
</span><span id=__span-5-14><a id=__codelineno-5-14 name=__codelineno-5-14 href=#__codelineno-5-14></a>version: &quot;1.2.0&quot;
</span><span id=__span-5-15><a id=__codelineno-5-15 name=__codelineno-5-15 href=#__codelineno-5-15></a>kind: compliance
</span><span id=__span-5-16><a id=__codelineno-5-16 name=__codelineno-5-16 href=#__codelineno-5-16></a>...
</span></code></pre></div> <p><strong>Response (304 Not Modified):</strong></p> <p>When <code>If-None-Match</code> matches current digest:</p> <div class="language-http highlight"><pre><span></span><code><span id=__span-6-1><a id=__codelineno-6-1 name=__codelineno-6-1 href=#__codelineno-6-1></a><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>304</span> <span class=ne>Not Modified</span>
</span><span id=__span-6-2><a id=__codelineno-6-2 name=__codelineno-6-2 href=#__codelineno-6-2></a><span class=na>ETag</span><span class=o>:</span> <span class=l>&quot;sha256:abc123...&quot;</span>
</span></code></pre></div> <p><strong>Response Headers:</strong></p> <table> <thead> <tr> <th>Header</th> <th>Required</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>ETag</code></td> <td>MUST</td> <td>Strong ETag; value MUST equal <code>X-Pack-Digest</code> (canonical digest). Used for conditional requests; stable across re-formatting.</td> </tr> <tr> <td><code>Content-Digest</code></td> <td>MUST</td> <td>RFC 9530 digest of the HTTP message body <strong>after content-coding is decoded</strong> (i.e. the bytes presented to the application). Computed over the decoded body bytes, not over the raw wire bytes. Server MUST send when body is present. Enables clients to verify transport integrity without gzip-variant issues.</td> </tr> <tr> <td><code>X-Pack-Digest</code></td> <td>MUST</td> <td>SHA256 digest of <strong>canonical</strong> content (strict YAML parse → JSON → JCS). This is the pack integrity digest used in lockfile, pins, and verification.</td> </tr> <tr> <td><code>X-Pack-Signature</code></td> <td>OPTIONAL</td> <td>Base64-encoded DSSE envelope (see §6.3). For packs &gt;4KB, use sidecar endpoint §6.3.3</td> </tr> <tr> <td><code>X-Pack-Signature-Endpoint</code></td> <td>SHOULD (if signed)</td> <td>Relative path to signature sidecar: <code>/packs/{name}/{version}.sig</code> (same path as GET sidecar)</td> </tr> <tr> <td><code>X-Pack-Key-Id</code></td> <td>MUST (if signed)</td> <td>SHA256 of SPKI public key</td> </tr> <tr> <td><code>X-Pack-Policy</code></td> <td>MUST</td> <td><code>commercial</code> or <code>open</code>. Drives signature requirement: <code>commercial</code> = client MUST verify signature (missing/invalid = fail); <code>open</code> = signature optional. Client MUST NOT rely on pack body (e.g. license in YAML) to decide; use this header.</td> </tr> <tr> <td><code>X-Pack-License</code></td> <td>MUST</td> <td>SPDX identifier (use <code>LicenseRef-*</code> for custom)</td> </tr> <tr> <td><code>Cache-Control</code></td> <td>MUST</td> <td><code>private</code> for authenticated, <code>public</code> for open</td> </tr> <tr> <td><code>Vary</code></td> <td>MUST</td> <td><code>Authorization, Accept-Encoding</code>. If the server ever serves multiple representations (e.g. different Accept), add <code>Vary: Accept</code>; for v1 only YAML is served, so Accept is informational and ETag is stable.</td> </tr> </tbody> </table> <p><strong>Media type:</strong> Pack response body uses <code>Content-Type: application/x-yaml</code> as the canonical media type in this SPEC. Clients and servers SHOULD use <code>application/x-yaml</code> consistently (not <code>application/yaml</code> or <code>text/yaml</code>) for interoperability.</p> <blockquote> <p><strong>Digest semantics (NORMATIVE):</strong></p> <ul> <li><strong>ETag</strong> = <code>X-Pack-Digest</code> value. Enables conditional GET; same digest in lockfile, pinned refs, and headers.</li> <li><strong>Content-Digest</strong> (RFC 9530): digest of the message body <strong>after content-coding is decoded</strong> (bytes presented to the application). Used to detect transport tampering; MAY differ from canonical if server reformats.</li> <li><strong>X-Pack-Digest</strong>: digest of the canonical form (strict YAML → JSON → JCS). CLI MUST verify this after fetch.</li> </ul> </blockquote> <p><strong>Error Responses:</strong></p> <table> <thead> <tr> <th>Code</th> <th>Meaning</th> <th>Body</th> </tr> </thead> <tbody> <tr> <td>401</td> <td>Unauthorized</td> <td><code>{"error": "authentication_required"}</code></td> </tr> <tr> <td>403</td> <td>Forbidden</td> <td><code>{"error": "license_expired"}</code> or <code>{"error": "pack_not_licensed"}</code></td> </tr> <tr> <td>404</td> <td>Not Found</td> <td><code>{"error": "pack_not_found"}</code></td> </tr> <tr> <td>410</td> <td>Gone</td> <td><code>{"error": "security_revocation", "reason": "...", "safe_version": "1.2.1"}</code></td> </tr> <tr> <td>413</td> <td>Payload Too Large</td> <td><code>{"error": "pack_exceeds_size_limit"}</code></td> </tr> <tr> <td>429</td> <td>Too Many Requests</td> <td><code>{"error": "rate_limit_exceeded", "retry_after": 60}</code></td> </tr> </tbody> </table> <p><strong>410 Gone semantics (NORMATIVE):</strong></p> <p><code>410</code> is reserved for <strong>security revocation</strong> (pack pulled due to vulnerability/incident), NOT for deprecation. Deprecated versions return <code>200</code> with <code>deprecated: true</code> in metadata.</p> <p><strong>CLI behavior on 410:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-7-1><a id=__codelineno-7-1 name=__codelineno-7-1 href=#__codelineno-7-1></a>Error: Pack &#39;eu-ai-act-pro@1.1.0&#39; has been revoked due to security issue.
</span><span id=__span-7-2><a id=__codelineno-7-2 name=__codelineno-7-2 href=#__codelineno-7-2></a>Reason: CVE-2026-1234 - rule bypass vulnerability
</span><span id=__span-7-3><a id=__codelineno-7-3 name=__codelineno-7-3 href=#__codelineno-7-3></a>Safe version: 1.2.1
</span><span id=__span-7-4><a id=__codelineno-7-4 name=__codelineno-7-4 href=#__codelineno-7-4></a>
</span><span id=__span-7-5><a id=__codelineno-7-5 name=__codelineno-7-5 href=#__codelineno-7-5></a>To proceed anyway (forensics only): --allow-revoked
</span></code></pre></div> <p>The <code>--allow-revoked</code> flag MUST: - Require explicit opt-in (flag set by user) - Log a warning to stderr - When the client detects a CI environment (e.g. <code>CI=true</code> or <code>GITHUB_ACTIONS=true</code>), the client MUST also require <code>ASSAY_ALLOW_REVOKED=forensics</code> to be set; otherwise treat use of <code>--allow-revoked</code> in CI as error. Outside CI, the flag alone is sufficient (with stderr warning).</p> <h4 id=head-packsnameversion>HEAD /packs/{name}/{version}<a class=headerlink href=#head-packsnameversion title="Permanent link">&para;</a></h4> <p>Metadata-only request (no body). Use for cache validation or digest lookup.</p> <p><strong>Request:</strong></p> <div class="language-http highlight"><pre><span></span><code><span id=__span-8-1><a id=__codelineno-8-1 name=__codelineno-8-1 href=#__codelineno-8-1></a><span class=nf>HEAD</span> <span class=nn>/packs/eu-ai-act-pro/1.2.0</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span><span id=__span-8-2><a id=__codelineno-8-2 name=__codelineno-8-2 href=#__codelineno-8-2></a><span class=na>Host</span><span class=o>:</span> <span class=l>registry.getassay.dev</span>
</span><span id=__span-8-3><a id=__codelineno-8-3 name=__codelineno-8-3 href=#__codelineno-8-3></a><span class=na>Authorization</span><span class=o>:</span> <span class=l>Bearer &lt;token&gt;</span>
</span></code></pre></div> <p><strong>Response (200 OK):</strong></p> <div class="language-http highlight"><pre><span></span><code><span id=__span-9-1><a id=__codelineno-9-1 name=__codelineno-9-1 href=#__codelineno-9-1></a><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
</span><span id=__span-9-2><a id=__codelineno-9-2 name=__codelineno-9-2 href=#__codelineno-9-2></a><span class=na>ETag</span><span class=o>:</span> <span class=l>&quot;sha256:abc123...&quot;</span>
</span><span id=__span-9-3><a id=__codelineno-9-3 name=__codelineno-9-3 href=#__codelineno-9-3></a><span class=na>X-Pack-Digest</span><span class=o>:</span> <span class=l>sha256:abc123...</span>
</span><span id=__span-9-4><a id=__codelineno-9-4 name=__codelineno-9-4 href=#__codelineno-9-4></a><span class=na>X-Pack-Policy</span><span class=o>:</span> <span class=l>commercial</span>
</span><span id=__span-9-5><a id=__codelineno-9-5 name=__codelineno-9-5 href=#__codelineno-9-5></a><span class=na>X-Pack-Key-Id</span><span class=o>:</span> <span class=l>sha256:def456...</span>
</span><span id=__span-9-6><a id=__codelineno-9-6 name=__codelineno-9-6 href=#__codelineno-9-6></a><span class=na>X-Pack-License</span><span class=o>:</span> <span class=l>LicenseRef-Assay-Enterprise-1.0</span>
</span><span id=__span-9-7><a id=__codelineno-9-7 name=__codelineno-9-7 href=#__codelineno-9-7></a><span class=na>Content-Length</span><span class=o>:</span> <span class=l>4096</span>
</span></code></pre></div> <p><strong>Use cases:</strong> - Pre-flight check before download - Digest lookup for lockfile generation - Cache validation without full fetch</p> <h4 id=get-packsnameversions>GET /packs/{name}/versions<a class=headerlink href=#get-packsnameversions title="Permanent link">&para;</a></h4> <p>List available versions.</p> <p><strong>Response (200 OK):</strong></p> <div class="language-json highlight"><pre><span></span><code><span id=__span-10-1><a id=__codelineno-10-1 name=__codelineno-10-1 href=#__codelineno-10-1></a><span class=p>{</span>
</span><span id=__span-10-2><a id=__codelineno-10-2 name=__codelineno-10-2 href=#__codelineno-10-2></a><span class=w>  </span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;eu-ai-act-pro&quot;</span><span class=p>,</span>
</span><span id=__span-10-3><a id=__codelineno-10-3 name=__codelineno-10-3 href=#__codelineno-10-3></a><span class=w>  </span><span class=nt>&quot;versions&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-10-4><a id=__codelineno-10-4 name=__codelineno-10-4 href=#__codelineno-10-4></a><span class=w>    </span><span class=p>{</span><span class=nt>&quot;version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1.2.0&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;released&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2026-01-15&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;deprecated&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>false</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;digest&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;sha256:abc...&quot;</span><span class=p>},</span>
</span><span id=__span-10-5><a id=__codelineno-10-5 name=__codelineno-10-5 href=#__codelineno-10-5></a><span class=w>    </span><span class=p>{</span><span class=nt>&quot;version&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1.1.0&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;released&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2025-11-01&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;deprecated&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;digest&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;sha256:def...&quot;</span><span class=p>}</span>
</span><span id=__span-10-6><a id=__codelineno-10-6 name=__codelineno-10-6 href=#__codelineno-10-6></a><span class=w>  </span><span class=p>],</span>
</span><span id=__span-10-7><a id=__codelineno-10-7 name=__codelineno-10-7 href=#__codelineno-10-7></a><span class=w>  </span><span class=nt>&quot;latest&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1.2.0&quot;</span>
</span><span id=__span-10-8><a id=__codelineno-10-8 name=__codelineno-10-8 href=#__codelineno-10-8></a><span class=p>}</span>
</span></code></pre></div> <h4 id=get-packs>GET /packs<a class=headerlink href=#get-packs title="Permanent link">&para;</a></h4> <p>List available packs (with pagination).</p> <p><strong>Request:</strong></p> <div class="language-http highlight"><pre><span></span><code><span id=__span-11-1><a id=__codelineno-11-1 name=__codelineno-11-1 href=#__codelineno-11-1></a><span class=nf>GET</span> <span class=nn>/packs?limit=50&amp;cursor=abc123</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span></code></pre></div> <p><strong>Response (200 OK):</strong></p> <div class="language-json highlight"><pre><span></span><code><span id=__span-12-1><a id=__codelineno-12-1 name=__codelineno-12-1 href=#__codelineno-12-1></a><span class=p>{</span>
</span><span id=__span-12-2><a id=__codelineno-12-2 name=__codelineno-12-2 href=#__codelineno-12-2></a><span class=w>  </span><span class=nt>&quot;packs&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-12-3><a id=__codelineno-12-3 name=__codelineno-12-3 href=#__codelineno-12-3></a><span class=w>    </span><span class=p>{</span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;eu-ai-act-pro&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;latest&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1.2.0&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;license&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;commercial&quot;</span><span class=p>},</span>
</span><span id=__span-12-4><a id=__codelineno-12-4 name=__codelineno-12-4 href=#__codelineno-12-4></a><span class=w>    </span><span class=p>{</span><span class=nt>&quot;name&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;soc2-pro&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;latest&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;1.0.0&quot;</span><span class=p>,</span><span class=w> </span><span class=nt>&quot;license&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;commercial&quot;</span><span class=p>}</span>
</span><span id=__span-12-5><a id=__codelineno-12-5 name=__codelineno-12-5 href=#__codelineno-12-5></a><span class=w>  </span><span class=p>],</span>
</span><span id=__span-12-6><a id=__codelineno-12-6 name=__codelineno-12-6 href=#__codelineno-12-6></a><span class=w>  </span><span class=nt>&quot;next_cursor&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;def456&quot;</span><span class=p>,</span>
</span><span id=__span-12-7><a id=__codelineno-12-7 name=__codelineno-12-7 href=#__codelineno-12-7></a><span class=w>  </span><span class=nt>&quot;has_more&quot;</span><span class=p>:</span><span class=w> </span><span class=kc>true</span>
</span><span id=__span-12-8><a id=__codelineno-12-8 name=__codelineno-12-8 href=#__codelineno-12-8></a><span class=p>}</span>
</span></code></pre></div> <p><strong>Pagination parameters:</strong></p> <table> <thead> <tr> <th>Parameter</th> <th>Default</th> <th>Max</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>limit</code></td> <td>50</td> <td>100</td> <td>Results per page</td> </tr> <tr> <td><code>cursor</code></td> <td>-</td> <td>-</td> <td>Opaque cursor for next page</td> </tr> </tbody> </table> <h3 id=44-rate-limiting>4.4 Rate Limiting<a class=headerlink href=#44-rate-limiting title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Endpoint</th> <th>Limit</th> <th>Window</th> </tr> </thead> <tbody> <tr> <td>GET /packs/{name}/{version}</td> <td>100</td> <td>1 minute</td> </tr> <tr> <td>GET /packs</td> <td>20</td> <td>1 minute</td> </tr> <tr> <td>Total per token</td> <td>500</td> <td>1 minute</td> </tr> </tbody> </table> <p><strong>Response headers:</strong></p> <div class="language-http highlight"><pre><span></span><code><span id=__span-13-1><a id=__codelineno-13-1 name=__codelineno-13-1 href=#__codelineno-13-1></a><span class=err>X-RateLimit-Limit: 100</span>
</span><span id=__span-13-2><a id=__codelineno-13-2 name=__codelineno-13-2 href=#__codelineno-13-2></a><span class=err>X-RateLimit-Remaining: 95</span>
</span><span id=__span-13-3><a id=__codelineno-13-3 name=__codelineno-13-3 href=#__codelineno-13-3></a><span class=err>X-RateLimit-Reset: 1706529600</span>
</span><span id=__span-13-4><a id=__codelineno-13-4 name=__codelineno-13-4 href=#__codelineno-13-4></a><span class=err>Retry-After: 30</span>
</span></code></pre></div> <hr> <h2 id=5-authentication>5. Authentication<a class=headerlink href=#5-authentication title="Permanent link">&para;</a></h2> <h3 id=51-token-authentication>5.1 Token Authentication<a class=headerlink href=#51-token-authentication title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-14-1><a id=__codelineno-14-1 name=__codelineno-14-1 href=#__codelineno-14-1></a><span class=c1># Environment variable</span>
</span><span id=__span-14-2><a id=__codelineno-14-2 name=__codelineno-14-2 href=#__codelineno-14-2></a><span class=nb>export</span><span class=w> </span><span class=nv>ASSAY_REGISTRY_TOKEN</span><span class=o>=</span>ast_...
</span><span id=__span-14-3><a id=__codelineno-14-3 name=__codelineno-14-3 href=#__codelineno-14-3></a>
</span><span id=__span-14-4><a id=__codelineno-14-4 name=__codelineno-14-4 href=#__codelineno-14-4></a><span class=c1># Or config file</span>
</span><span id=__span-14-5><a id=__codelineno-14-5 name=__codelineno-14-5 href=#__codelineno-14-5></a>assay<span class=w> </span>config<span class=w> </span><span class=nb>set</span><span class=w> </span>registry.token<span class=w> </span>ast_...
</span></code></pre></div> <p><strong>Token format</strong>: Opaque string, prefixed <code>ast_</code> (Assay Token).</p> <p><strong>Token properties:</strong></p> <table> <thead> <tr> <th>Property</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Prefix</td> <td><code>ast_</code></td> </tr> <tr> <td>Recommended TTL</td> <td>≤ 24h for CI, ≤ 90 days for dev</td> </tr> <tr> <td>Revocable</td> <td>Yes, via registry admin</td> </tr> <tr> <td>Scoped</td> <td>Optional (e.g., <code>packs:read</code>, <code>org:acme</code>)</td> </tr> </tbody> </table> <h3 id=52-oidc-authentication-github-actions>5.2 OIDC Authentication (GitHub Actions)<a class=headerlink href=#52-oidc-authentication-github-actions title="Permanent link">&para;</a></h3> <p>For CI/CD environments with OIDC, use <strong>token exchange</strong> (RECOMMENDED) rather than passing the OIDC ID token directly as bearer.</p> <h4 id=521-token-exchange-flow-normative>5.2.1 Token Exchange Flow (NORMATIVE)<a class=headerlink href=#521-token-exchange-flow-normative title="Permanent link">&para;</a></h4> <div class="language-text highlight"><pre><span></span><code><span id=__span-15-1><a id=__codelineno-15-1 name=__codelineno-15-1 href=#__codelineno-15-1></a>┌─────────────┐     ┌─────────────┐     ┌─────────────┐
</span><span id=__span-15-2><a id=__codelineno-15-2 name=__codelineno-15-2 href=#__codelineno-15-2></a>│   GitHub    │     │    CLI      │     │  Registry   │
</span><span id=__span-15-3><a id=__codelineno-15-3 name=__codelineno-15-3 href=#__codelineno-15-3></a>│   Actions   │     │             │     │             │
</span><span id=__span-15-4><a id=__codelineno-15-4 name=__codelineno-15-4 href=#__codelineno-15-4></a>└──────┬──────┘     └──────┬──────┘     └──────┬──────┘
</span><span id=__span-15-5><a id=__codelineno-15-5 name=__codelineno-15-5 href=#__codelineno-15-5></a>       │                   │                   │
</span><span id=__span-15-6><a id=__codelineno-15-6 name=__codelineno-15-6 href=#__codelineno-15-6></a>       │ 1. Request OIDC   │                   │
</span><span id=__span-15-7><a id=__codelineno-15-7 name=__codelineno-15-7 href=#__codelineno-15-7></a>       │    ID token       │                   │
</span><span id=__span-15-8><a id=__codelineno-15-8 name=__codelineno-15-8 href=#__codelineno-15-8></a>       │&lt;──────────────────│                   │
</span><span id=__span-15-9><a id=__codelineno-15-9 name=__codelineno-15-9 href=#__codelineno-15-9></a>       │                   │                   │
</span><span id=__span-15-10><a id=__codelineno-15-10 name=__codelineno-15-10 href=#__codelineno-15-10></a>       │ 2. ID token       │                   │
</span><span id=__span-15-11><a id=__codelineno-15-11 name=__codelineno-15-11 href=#__codelineno-15-11></a>       │   (aud=registry)  │                   │
</span><span id=__span-15-12><a id=__codelineno-15-12 name=__codelineno-15-12 href=#__codelineno-15-12></a>       │──────────────────&gt;│                   │
</span><span id=__span-15-13><a id=__codelineno-15-13 name=__codelineno-15-13 href=#__codelineno-15-13></a>       │                   │                   │
</span><span id=__span-15-14><a id=__codelineno-15-14 name=__codelineno-15-14 href=#__codelineno-15-14></a>       │                   │ 3. POST /auth/oidc/exchange
</span><span id=__span-15-15><a id=__codelineno-15-15 name=__codelineno-15-15 href=#__codelineno-15-15></a>       │                   │    { id_token: &quot;...&quot; }
</span><span id=__span-15-16><a id=__codelineno-15-16 name=__codelineno-15-16 href=#__codelineno-15-16></a>       │                   │──────────────────&gt;│
</span><span id=__span-15-17><a id=__codelineno-15-17 name=__codelineno-15-17 href=#__codelineno-15-17></a>       │                   │                   │
</span><span id=__span-15-18><a id=__codelineno-15-18 name=__codelineno-15-18 href=#__codelineno-15-18></a>       │                   │ 4. { access_token: &quot;ast_...&quot;,
</span><span id=__span-15-19><a id=__codelineno-15-19 name=__codelineno-15-19 href=#__codelineno-15-19></a>       │                   │      expires_in: 3600 }
</span><span id=__span-15-20><a id=__codelineno-15-20 name=__codelineno-15-20 href=#__codelineno-15-20></a>       │                   │&lt;──────────────────│
</span><span id=__span-15-21><a id=__codelineno-15-21 name=__codelineno-15-21 href=#__codelineno-15-21></a>       │                   │                   │
</span><span id=__span-15-22><a id=__codelineno-15-22 name=__codelineno-15-22 href=#__codelineno-15-22></a>       │                   │ 5. GET /packs/...
</span><span id=__span-15-23><a id=__codelineno-15-23 name=__codelineno-15-23 href=#__codelineno-15-23></a>       │                   │    Authorization: Bearer ast_...
</span><span id=__span-15-24><a id=__codelineno-15-24 name=__codelineno-15-24 href=#__codelineno-15-24></a>       │                   │──────────────────&gt;│
</span></code></pre></div> <p><strong>Why token exchange:</strong></p> <ul> <li>Registry can enforce scopes (e.g., <code>packs:read</code>, <code>org:acme</code>)</li> <li>Registry can revoke/rotate without GitHub-side changes</li> <li>Shorter token lifetime (10-60 min vs GitHub's ~15 min ID token)</li> <li>Prevents accidental ID token leakage in logs</li> </ul> <h4 id=522-exchange-endpoint>5.2.2 Exchange Endpoint<a class=headerlink href=#522-exchange-endpoint title="Permanent link">&para;</a></h4> <p><strong>POST /auth/oidc/exchange</strong></p> <div class="language-http highlight"><pre><span></span><code><span id=__span-16-1><a id=__codelineno-16-1 name=__codelineno-16-1 href=#__codelineno-16-1></a><span class=nf>POST</span> <span class=nn>/auth/oidc/exchange</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span><span id=__span-16-2><a id=__codelineno-16-2 name=__codelineno-16-2 href=#__codelineno-16-2></a><span class=na>Host</span><span class=o>:</span> <span class=l>registry.getassay.dev</span>
</span><span id=__span-16-3><a id=__codelineno-16-3 name=__codelineno-16-3 href=#__codelineno-16-3></a><span class=na>Content-Type</span><span class=o>:</span> <span class=l>application/json</span>
</span><span id=__span-16-4><a id=__codelineno-16-4 name=__codelineno-16-4 href=#__codelineno-16-4></a>
</span><span id=__span-16-5><a id=__codelineno-16-5 name=__codelineno-16-5 href=#__codelineno-16-5></a><span class=p>{</span>
</span><span id=__span-16-6><a id=__codelineno-16-6 name=__codelineno-16-6 href=#__codelineno-16-6></a><span class=w>  </span><span class=nt>&quot;id_token&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;GitHub OIDC ID token&gt;&quot;</span><span class=p>,</span>
</span><span id=__span-16-7><a id=__codelineno-16-7 name=__codelineno-16-7 href=#__codelineno-16-7></a><span class=w>  </span><span class=nt>&quot;scope&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;packs:read&quot;</span>
</span><span id=__span-16-8><a id=__codelineno-16-8 name=__codelineno-16-8 href=#__codelineno-16-8></a><span class=p>}</span>
</span></code></pre></div> <p><strong>Response (200 OK):</strong></p> <div class="language-json highlight"><pre><span></span><code><span id=__span-17-1><a id=__codelineno-17-1 name=__codelineno-17-1 href=#__codelineno-17-1></a><span class=p>{</span>
</span><span id=__span-17-2><a id=__codelineno-17-2 name=__codelineno-17-2 href=#__codelineno-17-2></a><span class=w>  </span><span class=nt>&quot;access_token&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;ast_abc123...&quot;</span><span class=p>,</span>
</span><span id=__span-17-3><a id=__codelineno-17-3 name=__codelineno-17-3 href=#__codelineno-17-3></a><span class=w>  </span><span class=nt>&quot;token_type&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Bearer&quot;</span><span class=p>,</span>
</span><span id=__span-17-4><a id=__codelineno-17-4 name=__codelineno-17-4 href=#__codelineno-17-4></a><span class=w>  </span><span class=nt>&quot;expires_in&quot;</span><span class=p>:</span><span class=w> </span><span class=mi>3600</span><span class=p>,</span>
</span><span id=__span-17-5><a id=__codelineno-17-5 name=__codelineno-17-5 href=#__codelineno-17-5></a><span class=w>  </span><span class=nt>&quot;scope&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;packs:read&quot;</span>
</span><span id=__span-17-6><a id=__codelineno-17-6 name=__codelineno-17-6 href=#__codelineno-17-6></a><span class=p>}</span>
</span></code></pre></div> <p><strong>Error Responses:</strong></p> <table> <thead> <tr> <th>Code</th> <th>Error</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td>400</td> <td><code>invalid_request</code></td> <td>Missing or malformed id_token</td> </tr> <tr> <td>401</td> <td><code>invalid_token</code></td> <td>ID token expired, invalid signature, wrong audience</td> </tr> <tr> <td>403</td> <td><code>access_denied</code></td> <td>Subject not authorized for requested scope</td> </tr> </tbody> </table> <h4 id=523-github-actions-example>5.2.3 GitHub Actions Example<a class=headerlink href=#523-github-actions-example title="Permanent link">&para;</a></h4> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-18-1><a id=__codelineno-18-1 name=__codelineno-18-1 href=#__codelineno-18-1></a><span class=nt>permissions</span><span class=p>:</span>
</span><span id=__span-18-2><a id=__codelineno-18-2 name=__codelineno-18-2 href=#__codelineno-18-2></a><span class=w>  </span><span class=nt>id-token</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">write</span>
</span><span id=__span-18-3><a id=__codelineno-18-3 name=__codelineno-18-3 href=#__codelineno-18-3></a>
</span><span id=__span-18-4><a id=__codelineno-18-4 name=__codelineno-18-4 href=#__codelineno-18-4></a><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-18-5><a id=__codelineno-18-5 name=__codelineno-18-5 href=#__codelineno-18-5></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Authenticate to Assay Registry</span>
</span><span id=__span-18-6><a id=__codelineno-18-6 name=__codelineno-18-6 href=#__codelineno-18-6></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-18-7><a id=__codelineno-18-7 name=__codelineno-18-7 href=#__codelineno-18-7></a><span class=w>      </span><span class=no># 1. Get GitHub OIDC ID token</span>
</span><span id=__span-18-8><a id=__codelineno-18-8 name=__codelineno-18-8 href=#__codelineno-18-8></a><span class=w>      </span><span class=no>ID_TOKEN=$(curl -s -H &quot;Authorization: bearer $ACTIONS_ID_TOKEN_REQUEST_TOKEN&quot; \</span>
</span><span id=__span-18-9><a id=__codelineno-18-9 name=__codelineno-18-9 href=#__codelineno-18-9></a><span class=w>        </span><span class=no>&quot;$ACTIONS_ID_TOKEN_REQUEST_URL&amp;audience=https://registry.getassay.dev&quot; | jq -r &#39;.value&#39;)</span>
</span><span id=__span-18-10><a id=__codelineno-18-10 name=__codelineno-18-10 href=#__codelineno-18-10></a>
</span><span id=__span-18-11><a id=__codelineno-18-11 name=__codelineno-18-11 href=#__codelineno-18-11></a><span class=w>      </span><span class=no># 2. Exchange for registry access token</span>
</span><span id=__span-18-12><a id=__codelineno-18-12 name=__codelineno-18-12 href=#__codelineno-18-12></a><span class=w>      </span><span class=no>RESPONSE=$(curl -s -X POST https://registry.getassay.dev/v1/auth/oidc/exchange \</span>
</span><span id=__span-18-13><a id=__codelineno-18-13 name=__codelineno-18-13 href=#__codelineno-18-13></a><span class=w>        </span><span class=no>-H &quot;Content-Type: application/json&quot; \</span>
</span><span id=__span-18-14><a id=__codelineno-18-14 name=__codelineno-18-14 href=#__codelineno-18-14></a><span class=w>        </span><span class=no>-d &quot;{\&quot;id_token\&quot;: \&quot;$ID_TOKEN\&quot;, \&quot;scope\&quot;: \&quot;packs:read\&quot;}&quot;)</span>
</span><span id=__span-18-15><a id=__codelineno-18-15 name=__codelineno-18-15 href=#__codelineno-18-15></a>
</span><span id=__span-18-16><a id=__codelineno-18-16 name=__codelineno-18-16 href=#__codelineno-18-16></a><span class=w>      </span><span class=no># 3. Extract access token</span>
</span><span id=__span-18-17><a id=__codelineno-18-17 name=__codelineno-18-17 href=#__codelineno-18-17></a><span class=w>      </span><span class=no>ACCESS_TOKEN=$(echo &quot;$RESPONSE&quot; | jq -r &#39;.access_token&#39;)</span>
</span><span id=__span-18-18><a id=__codelineno-18-18 name=__codelineno-18-18 href=#__codelineno-18-18></a><span class=w>      </span><span class=no>echo &quot;ASSAY_REGISTRY_TOKEN=$ACCESS_TOKEN&quot; &gt;&gt; $GITHUB_ENV</span>
</span></code></pre></div> <h4 id=524-registry-oidc-configuration>5.2.4 Registry OIDC Configuration<a class=headerlink href=#524-registry-oidc-configuration title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Field</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td>Issuer</td> <td><code>https://token.actions.githubusercontent.com</code></td> </tr> <tr> <td>Audience</td> <td><code>https://registry.getassay.dev</code></td> </tr> <tr> <td>JWKS URI</td> <td><code>https://token.actions.githubusercontent.com/.well-known/jwks</code></td> </tr> </tbody> </table> <p><strong>Subject claim patterns (NORMATIVE):</strong></p> <p>Registry MUST support flexible subject matching, not hardcoded <code>refs/heads/main</code>:</p> <table> <thead> <tr> <th>Pattern</th> <th>Matches</th> </tr> </thead> <tbody> <tr> <td><code>repo:ORG/REPO:*</code></td> <td>Any ref in repo</td> </tr> <tr> <td><code>repo:ORG/REPO:ref:refs/heads/*</code></td> <td>Any branch</td> </tr> <tr> <td><code>repo:ORG/REPO:ref:refs/heads/main</code></td> <td>Specific branch</td> </tr> <tr> <td><code>repo:ORG/REPO:environment:production</code></td> <td>Specific environment</td> </tr> </tbody> </table> <h4 id=525-token-handling>5.2.5 Token Handling<a class=headerlink href=#525-token-handling title="Permanent link">&para;</a></h4> <ul> <li>CLI MUST handle token expiry gracefully (re-exchange on 401)</li> <li>CLI SHOULD allow 30s clock skew tolerance</li> <li>CLI MUST implement exponential backoff on exchange failures (1s, 2s, 4s, max 30s)</li> <li>CLI MUST cache exchanged token until <code>expires_in - 60s</code></li> </ul> <h3 id=53-no-authentication-open-packs>5.3 No Authentication (Open Packs)<a class=headerlink href=#53-no-authentication-open-packs title="Permanent link">&para;</a></h3> <p>Open packs MAY be served without authentication for convenience:</p> <div class="language-http highlight"><pre><span></span><code><span id=__span-19-1><a id=__codelineno-19-1 name=__codelineno-19-1 href=#__codelineno-19-1></a><span class=nf>GET</span> <span class=nn>/packs/eu-ai-act-baseline/1.0.0</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span><span id=__span-19-2><a id=__codelineno-19-2 name=__codelineno-19-2 href=#__codelineno-19-2></a><span class=err>#</span> <span class=l>No Authorization header required</span>
</span></code></pre></div> <hr> <h2 id=6-integrity-verification>6. Integrity Verification<a class=headerlink href=#6-integrity-verification title="Permanent link">&para;</a></h2> <h3 id=61-pack-canonical-form-normative>6.1 Pack Canonical Form (NORMATIVE)<a class=headerlink href=#61-pack-canonical-form-normative title="Permanent link">&para;</a></h3> <p>YAML parsing is notoriously inconsistent. To ensure deterministic digests, packs MUST conform to a strict subset:</p> <p><strong>Strict YAML subset (NORMATIVE):</strong></p> <table> <thead> <tr> <th>Feature</th> <th>Status</th> </tr> </thead> <tbody> <tr> <td>Strings</td> <td>✅ Allowed</td> </tr> <tr> <td>Integers</td> <td>✅ Allowed (JSON-representable: magnitude ≤ 2^53; negatives allowed)</td> </tr> <tr> <td>Booleans, null</td> <td>✅ Allowed</td> </tr> <tr> <td>Arrays, objects</td> <td>✅ Allowed</td> </tr> <tr> <td>Floats</td> <td>⚠️ SHOULD avoid (see below)</td> </tr> <tr> <td>Duplicate keys (at any nesting level)</td> <td>❌ MUST reject — parsing MUST fail. Implementations MUST detect duplicate keys (e.g. pre-scan or parser that reports duplicates); "last key wins" is NOT compliant.</td> </tr> <tr> <td>Anchors/aliases</td> <td>❌ MUST reject</td> </tr> <tr> <td>Tags (!!timestamp, !!binary, etc.)</td> <td>❌ MUST reject</td> </tr> <tr> <td>Multi-document (---)</td> <td>❌ MUST reject</td> </tr> </tbody> </table> <p><strong>Number semantics (NORMATIVE):</strong></p> <ul> <li>Integers MUST be representable as JSON numbers (magnitude ≤ 2^53; use string for larger values).</li> <li>Floats SHOULD be avoided; use strings for precise decimals (e.g. <code>"0.95"</code>).</li> <li>If floats are used, they MUST be finite and MUST survive <code>parse → JCS → parse</code> round-trip losslessly (per RFC 8785 number rules).</li> <li>Leading zeros, exponent notation: normalize per JCS (RFC 8785 §3.2.4).</li> </ul> <p><strong>Canonical bytes (NORMATIVE):</strong> The output of the canonicalization step (JCS) used for digest and DSSE payload MUST be UTF-8 encoded, with no BOM and no trailing newline. This ensures interoperability across implementations (e.g. JCS libraries that append newlines are non-compliant unless they strip before use).</p> <p><strong>Canonicalization algorithm:</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-20-1><a id=__codelineno-20-1 name=__codelineno-20-1 href=#__codelineno-20-1></a>1. Parse YAML in strict mode: reject duplicate keys, anchors/aliases, unknown tags, multi-document
</span><span id=__span-20-2><a id=__codelineno-20-2 name=__codelineno-20-2 href=#__codelineno-20-2></a>2. Convert to JSON value (strings, numbers, bools, null, arrays, objects)
</span><span id=__span-20-3><a id=__codelineno-20-3 name=__codelineno-20-3 href=#__codelineno-20-3></a>3. Apply JCS canonicalization (RFC 8785); output = UTF-8, no BOM, no trailing newline
</span><span id=__span-20-4><a id=__codelineno-20-4 name=__codelineno-20-4 href=#__codelineno-20-4></a>4. Compute SHA-256 hash
</span><span id=__span-20-5><a id=__codelineno-20-5 name=__codelineno-20-5 href=#__codelineno-20-5></a>5. Format as &quot;sha256:{hex_digest}&quot;
</span></code></pre></div> <p><strong>Implementation:</strong> Use a parser or pre-pass that guarantees duplicate-key detection and rejection. Parser configurations that silently take "last key wins" are non-compliant. Conformance test: a pack with duplicate keys at any level MUST be rejected before digest computation.</p> <h3 id=62-digest-verification-normative>6.2 Digest Verification (NORMATIVE)<a class=headerlink href=#62-digest-verification-normative title="Permanent link">&para;</a></h3> <p>After fetching, CLI MUST verify digest:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-21-1><a id=__codelineno-21-1 name=__codelineno-21-1 href=#__codelineno-21-1></a><span class=kd>let</span><span class=w> </span><span class=n>fetched_content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fetch_pack</span><span class=p>(</span><span class=n>url</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-21-2><a id=__codelineno-21-2 name=__codelineno-21-2 href=#__codelineno-21-2></a><span class=kd>let</span><span class=w> </span><span class=n>canonical</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jcs_canonicalize</span><span class=p>(</span><span class=n>parse_yaml_strict</span><span class=p>(</span><span class=n>fetched_content</span><span class=p>)</span><span class=o>?</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-21-3><a id=__codelineno-21-3 name=__codelineno-21-3 href=#__codelineno-21-3></a><span class=kd>let</span><span class=w> </span><span class=n>computed_digest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=fm>format!</span><span class=p>(</span><span class=s>&quot;sha256:{}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>sha256_hex</span><span class=p>(</span><span class=o>&amp;</span><span class=n>canonical</span><span class=p>));</span>
</span><span id=__span-21-4><a id=__codelineno-21-4 name=__codelineno-21-4 href=#__codelineno-21-4></a><span class=kd>let</span><span class=w> </span><span class=n>expected_digest</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>response</span><span class=p>.</span><span class=n>header</span><span class=p>(</span><span class=s>&quot;X-Pack-Digest&quot;</span><span class=p>);</span>
</span><span id=__span-21-5><a id=__codelineno-21-5 name=__codelineno-21-5 href=#__codelineno-21-5></a>
</span><span id=__span-21-6><a id=__codelineno-21-6 name=__codelineno-21-6 href=#__codelineno-21-6></a><span class=k>if</span><span class=w> </span><span class=n>computed_digest</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>expected_digest</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-7><a id=__codelineno-21-7 name=__codelineno-21-7 href=#__codelineno-21-7></a><span class=w>    </span><span class=k>return</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=n>PackIntegrityError</span><span class=p>::</span><span class=n>DigestMismatch</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-21-8><a id=__codelineno-21-8 name=__codelineno-21-8 href=#__codelineno-21-8></a><span class=w>        </span><span class=n>expected</span><span class=p>:</span><span class=w> </span><span class=nc>expected_digest</span><span class=p>,</span>
</span><span id=__span-21-9><a id=__codelineno-21-9 name=__codelineno-21-9 href=#__codelineno-21-9></a><span class=w>        </span><span class=n>computed</span><span class=p>:</span><span class=w> </span><span class=nc>computed_digest</span><span class=p>,</span>
</span><span id=__span-21-10><a id=__codelineno-21-10 name=__codelineno-21-10 href=#__codelineno-21-10></a><span class=w>    </span><span class=p>});</span>
</span><span id=__span-21-11><a id=__codelineno-21-11 name=__codelineno-21-11 href=#__codelineno-21-11></a><span class=p>}</span>
</span></code></pre></div> <h3 id=63-signature-verification-normative>6.3 Signature Verification (NORMATIVE)<a class=headerlink href=#63-signature-verification-normative title="Permanent link">&para;</a></h3> <p>Digest alone provides <strong>integrity</strong> but not <strong>authenticity</strong>. A compromised registry could serve malicious content with matching digest.</p> <p><strong>Verification requirements:</strong> The client determines "signature required" from the <strong><code>X-Pack-Policy</code></strong> response header (§4.3), not from pack body content. When <code>X-Pack-Policy: commercial</code>, the client MUST verify signature; when <code>open</code>, signature is optional.</p> <table> <thead> <tr> <th>Pack Type</th> <th>Signature Verification</th> </tr> </thead> <tbody> <tr> <td>Commercial (registry; <code>X-Pack-Policy: commercial</code>)</td> <td>MUST verify</td> </tr> <tr> <td>Open (registry; <code>X-Pack-Policy: open</code>)</td> <td>SHOULD verify</td> </tr> <tr> <td>BYOS</td> <td>SHOULD verify (if signature present; see §9)</td> </tr> <tr> <td>Local file</td> <td>MAY verify</td> </tr> </tbody> </table> <h4 id=631-dsse-envelope-format-normative>6.3.1 DSSE Envelope Format (NORMATIVE)<a class=headerlink href=#631-dsse-envelope-format-normative title="Permanent link">&para;</a></h4> <p><code>X-Pack-Signature</code> contains a <strong>Base64-encoded DSSE envelope</strong> (not raw signature):</p> <div class="language-json highlight"><pre><span></span><code><span id=__span-22-1><a id=__codelineno-22-1 name=__codelineno-22-1 href=#__codelineno-22-1></a><span class=p>{</span>
</span><span id=__span-22-2><a id=__codelineno-22-2 name=__codelineno-22-2 href=#__codelineno-22-2></a><span class=w>  </span><span class=nt>&quot;payloadType&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;application/vnd.assay.pack.v1+jcs&quot;</span><span class=p>,</span>
</span><span id=__span-22-3><a id=__codelineno-22-3 name=__codelineno-22-3 href=#__codelineno-22-3></a><span class=w>  </span><span class=nt>&quot;payload&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;base64-encoded-canonical-bytes&gt;&quot;</span><span class=p>,</span>
</span><span id=__span-22-4><a id=__codelineno-22-4 name=__codelineno-22-4 href=#__codelineno-22-4></a><span class=w>  </span><span class=nt>&quot;signatures&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-22-5><a id=__codelineno-22-5 name=__codelineno-22-5 href=#__codelineno-22-5></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-22-6><a id=__codelineno-22-6 name=__codelineno-22-6 href=#__codelineno-22-6></a><span class=w>      </span><span class=nt>&quot;keyid&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;sha256:def456...&quot;</span><span class=p>,</span>
</span><span id=__span-22-7><a id=__codelineno-22-7 name=__codelineno-22-7 href=#__codelineno-22-7></a><span class=w>      </span><span class=nt>&quot;sig&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;base64-encoded-Ed25519-signature&gt;&quot;</span>
</span><span id=__span-22-8><a id=__codelineno-22-8 name=__codelineno-22-8 href=#__codelineno-22-8></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-22-9><a id=__codelineno-22-9 name=__codelineno-22-9 href=#__codelineno-22-9></a><span class=w>  </span><span class=p>]</span>
</span><span id=__span-22-10><a id=__codelineno-22-10 name=__codelineno-22-10 href=#__codelineno-22-10></a><span class=p>}</span>
</span></code></pre></div> <p><strong>Fields:</strong></p> <table> <thead> <tr> <th>Field</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>payloadType</code></td> <td>MUST be <code>application/vnd.assay.pack.v1+jcs</code></td> </tr> <tr> <td><code>payload</code></td> <td>Base64-encoded canonical bytes (from §6.1: UTF-8, no BOM, no trailing newline)</td> </tr> <tr> <td><code>signatures[].keyid</code></td> <td>SHA256 of SPKI public key (matches <code>X-Pack-Key-Id</code>)</td> </tr> <tr> <td><code>signatures[].sig</code></td> <td>Ed25519 signature over PAE(payloadType, payload)</td> </tr> </tbody> </table> <p><strong>PAE (Pre-Authentication Encoding):</strong></p> <div class="language-text highlight"><pre><span></span><code><span id=__span-23-1><a id=__codelineno-23-1 name=__codelineno-23-1 href=#__codelineno-23-1></a>PAE(payloadType, payload) =
</span><span id=__span-23-2><a id=__codelineno-23-2 name=__codelineno-23-2 href=#__codelineno-23-2></a>  &quot;DSSEv1&quot; + SP +
</span><span id=__span-23-3><a id=__codelineno-23-3 name=__codelineno-23-3 href=#__codelineno-23-3></a>  len(payloadType) + SP + payloadType + SP +
</span><span id=__span-23-4><a id=__codelineno-23-4 name=__codelineno-23-4 href=#__codelineno-23-4></a>  len(payload) + SP + payload
</span></code></pre></div> <p>Where <code>SP</code> = space (0x20), <code>len()</code> = decimal string of byte length.</p> <h4 id=632-verification-flow>6.3.2 Verification Flow<a class=headerlink href=#632-verification-flow title="Permanent link">&para;</a></h4> <div class="language-rust highlight"><pre><span></span><code><span id=__span-24-1><a id=__codelineno-24-1 name=__codelineno-24-1 href=#__codelineno-24-1></a><span class=c1>// 1. Decode DSSE envelope from header</span>
</span><span id=__span-24-2><a id=__codelineno-24-2 name=__codelineno-24-2 href=#__codelineno-24-2></a><span class=kd>let</span><span class=w> </span><span class=n>envelope</span><span class=p>:</span><span class=w> </span><span class=nc>DsseEnvelope</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>base64_decode_json</span><span class=p>(</span><span class=n>response</span><span class=p>.</span><span class=n>header</span><span class=p>(</span><span class=s>&quot;X-Pack-Signature&quot;</span><span class=p>)</span><span class=o>?</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-24-3><a id=__codelineno-24-3 name=__codelineno-24-3 href=#__codelineno-24-3></a>
</span><span id=__span-24-4><a id=__codelineno-24-4 name=__codelineno-24-4 href=#__codelineno-24-4></a><span class=c1>// 2. Verify payloadType</span>
</span><span id=__span-24-5><a id=__codelineno-24-5 name=__codelineno-24-5 href=#__codelineno-24-5></a><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>envelope</span><span class=p>.</span><span class=n>payload_type</span><span class=p>,</span><span class=w> </span><span class=s>&quot;application/vnd.assay.pack.v1+jcs&quot;</span><span class=p>);</span>
</span><span id=__span-24-6><a id=__codelineno-24-6 name=__codelineno-24-6 href=#__codelineno-24-6></a>
</span><span id=__span-24-7><a id=__codelineno-24-7 name=__codelineno-24-7 href=#__codelineno-24-7></a><span class=c1>// 3. Verify payload matches canonical content</span>
</span><span id=__span-24-8><a id=__codelineno-24-8 name=__codelineno-24-8 href=#__codelineno-24-8></a><span class=kd>let</span><span class=w> </span><span class=n>canonical</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jcs_canonicalize</span><span class=p>(</span><span class=n>parse_yaml_strict</span><span class=p>(</span><span class=n>content</span><span class=p>)</span><span class=o>?</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-24-9><a id=__codelineno-24-9 name=__codelineno-24-9 href=#__codelineno-24-9></a><span class=fm>assert_eq!</span><span class=p>(</span><span class=n>base64_decode</span><span class=p>(</span><span class=o>&amp;</span><span class=n>envelope</span><span class=p>.</span><span class=n>payload</span><span class=p>)</span><span class=o>?</span><span class=p>,</span><span class=w> </span><span class=n>canonical</span><span class=p>);</span>
</span><span id=__span-24-10><a id=__codelineno-24-10 name=__codelineno-24-10 href=#__codelineno-24-10></a>
</span><span id=__span-24-11><a id=__codelineno-24-11 name=__codelineno-24-11 href=#__codelineno-24-11></a><span class=c1>// 4. Get trusted public key</span>
</span><span id=__span-24-12><a id=__codelineno-24-12 name=__codelineno-24-12 href=#__codelineno-24-12></a><span class=kd>let</span><span class=w> </span><span class=n>key_id</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=o>&amp;</span><span class=n>envelope</span><span class=p>.</span><span class=n>signatures</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>keyid</span><span class=p>;</span>
</span><span id=__span-24-13><a id=__codelineno-24-13 name=__codelineno-24-13 href=#__codelineno-24-13></a><span class=kd>let</span><span class=w> </span><span class=n>public_key</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>trust_store</span><span class=p>.</span><span class=n>get_key</span><span class=p>(</span><span class=n>key_id</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-24-14><a id=__codelineno-24-14 name=__codelineno-24-14 href=#__codelineno-24-14></a>
</span><span id=__span-24-15><a id=__codelineno-24-15 name=__codelineno-24-15 href=#__codelineno-24-15></a><span class=c1>// 5. Verify signature over PAE</span>
</span><span id=__span-24-16><a id=__codelineno-24-16 name=__codelineno-24-16 href=#__codelineno-24-16></a><span class=kd>let</span><span class=w> </span><span class=n>pae</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>dsse_pae</span><span class=p>(</span><span class=o>&amp;</span><span class=n>envelope</span><span class=p>.</span><span class=n>payload_type</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>envelope</span><span class=p>.</span><span class=n>payload</span><span class=p>);</span>
</span><span id=__span-24-17><a id=__codelineno-24-17 name=__codelineno-24-17 href=#__codelineno-24-17></a><span class=n>verify_ed25519</span><span class=p>(</span><span class=n>public_key</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>pae</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>envelope</span><span class=p>.</span><span class=n>signatures</span><span class=p>[</span><span class=mi>0</span><span class=p>].</span><span class=n>sig</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span></code></pre></div> <h4 id=633-signature-sidecar-endpoint-recommended>6.3.3 Signature Sidecar Endpoint (RECOMMENDED)<a class=headerlink href=#633-signature-sidecar-endpoint-recommended title="Permanent link">&para;</a></h4> <p><strong>Problem</strong>: DSSE envelopes include the payload (canonical bytes), which can exceed HTTP header limits (~8KB) for larger packs. Reverse proxies and CDNs may silently truncate or reject oversized headers.</p> <p><strong>Solution</strong>: Deliver signatures via a sidecar endpoint instead of headers.</p> <p><strong>Endpoint (NORMATIVE):</strong></p> <div class="language-http highlight"><pre><span></span><code><span id=__span-25-1><a id=__codelineno-25-1 name=__codelineno-25-1 href=#__codelineno-25-1></a><span class=err>GET /packs/{name}/{version}.sig</span>
</span><span id=__span-25-2><a id=__codelineno-25-2 name=__codelineno-25-2 href=#__codelineno-25-2></a><span class=err>Authorization: Bearer &lt;token&gt;</span>
</span><span id=__span-25-3><a id=__codelineno-25-3 name=__codelineno-25-3 href=#__codelineno-25-3></a>
</span><span id=__span-25-4><a id=__codelineno-25-4 name=__codelineno-25-4 href=#__codelineno-25-4></a><span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span> <span class=m>200</span> <span class=ne>OK</span>
</span><span id=__span-25-5><a id=__codelineno-25-5 name=__codelineno-25-5 href=#__codelineno-25-5></a><span class=na>Content-Type</span><span class=o>:</span> <span class=l>application/vnd.dsse.envelope+json</span>
</span><span id=__span-25-6><a id=__codelineno-25-6 name=__codelineno-25-6 href=#__codelineno-25-6></a>
</span><span id=__span-25-7><a id=__codelineno-25-7 name=__codelineno-25-7 href=#__codelineno-25-7></a><span class=p>{</span>
</span><span id=__span-25-8><a id=__codelineno-25-8 name=__codelineno-25-8 href=#__codelineno-25-8></a><span class=w>  </span><span class=nt>&quot;payloadType&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;application/vnd.assay.pack.v1+jcs&quot;</span><span class=p>,</span>
</span><span id=__span-25-9><a id=__codelineno-25-9 name=__codelineno-25-9 href=#__codelineno-25-9></a><span class=w>  </span><span class=nt>&quot;payload&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;base64-encoded-canonical-bytes&gt;&quot;</span><span class=p>,</span>
</span><span id=__span-25-10><a id=__codelineno-25-10 name=__codelineno-25-10 href=#__codelineno-25-10></a><span class=w>  </span><span class=nt>&quot;signatures&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-25-11><a id=__codelineno-25-11 name=__codelineno-25-11 href=#__codelineno-25-11></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-25-12><a id=__codelineno-25-12 name=__codelineno-25-12 href=#__codelineno-25-12></a><span class=w>      </span><span class=nt>&quot;keyid&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;sha256:def456...&quot;</span><span class=p>,</span>
</span><span id=__span-25-13><a id=__codelineno-25-13 name=__codelineno-25-13 href=#__codelineno-25-13></a><span class=w>      </span><span class=nt>&quot;sig&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;base64-encoded-Ed25519-signature&gt;&quot;</span>
</span><span id=__span-25-14><a id=__codelineno-25-14 name=__codelineno-25-14 href=#__codelineno-25-14></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-25-15><a id=__codelineno-25-15 name=__codelineno-25-15 href=#__codelineno-25-15></a><span class=w>  </span><span class=p>]</span>
</span><span id=__span-25-16><a id=__codelineno-25-16 name=__codelineno-25-16 href=#__codelineno-25-16></a><span class=p>}</span>
</span></code></pre></div> <p><strong>Response codes:</strong></p> <table> <thead> <tr> <th>Status</th> <th>Meaning</th> </tr> </thead> <tbody> <tr> <td>200</td> <td>Signature available (DSSE envelope in body)</td> </tr> <tr> <td>404</td> <td>Signature not available. For <strong>commercial</strong> packs: client MUST treat as failure (pack unsigned or registry misconfiguration). For <strong>open</strong> packs: client MAY proceed without signature.</td> </tr> <tr> <td>401</td> <td>Authentication required</td> </tr> </tbody> </table> <p><strong>Commercial packs (NORMATIVE):</strong> Registry MUST provide a signature (either <code>X-Pack-Signature</code> header or sidecar GET <code>/packs/{name}/{version}.sig</code> returning 200). If the client resolves the pack as commercial and neither header nor sidecar yields a valid signature (e.g. sidecar returns 404), the client MUST reject the pack and MUST NOT use it. "Unsigned" is not allowed for commercial.</p> <p><strong>Client behavior (NORMATIVE):</strong></p> <ol> <li>When <code>X-Pack-Signature-Endpoint</code> is present (e.g. <code>/packs/{name}/{version}.sig</code>), client SHOULD prefer fetching the signature from the sidecar (avoids header size limits); client MAY try <code>X-Pack-Signature</code> header first for backward compatibility.</li> <li>If header absent or invalid, client MUST fetch from sidecar endpoint when the pack is commercial or when signature is required.</li> <li>For commercial packs: missing signature (header absent and sidecar 404 or invalid) MUST result in hard failure.</li> <li><code>fetch_pack_with_signature()</code> may fetch content and signature in parallel.</li> </ol> <p><strong>Registry behavior:</strong></p> <ul> <li>Registries MUST support the sidecar endpoint <code>GET /packs/{name}/{version}.sig</code> for all signed packs.</li> <li>Registries MAY also include <code>X-Pack-Signature</code> header for small packs (&lt;4KB).</li> <li>Registries SHOULD set <code>X-Pack-Signature-Endpoint: /packs/{name}/{version}.sig</code> to indicate sidecar availability (path MUST match the GET endpoint above).</li> </ul> <p><strong>Header size guidance:</strong></p> <table> <thead> <tr> <th>Pack Size</th> <th>Canonical Size</th> <th>Envelope Size</th> <th>Delivery</th> </tr> </thead> <tbody> <tr> <td>&lt; 4KB</td> <td>&lt; 3KB</td> <td>&lt; 4KB</td> <td>Header OK</td> </tr> <tr> <td>4KB-100KB</td> <td>3-75KB</td> <td>4-100KB</td> <td>Sidecar REQUIRED</td> </tr> <tr> <td>&gt; 100KB</td> <td>&gt; 75KB</td> <td>&gt; 100KB</td> <td>Sidecar REQUIRED</td> </tr> </tbody> </table> <p><strong>Security note</strong>: The sidecar endpoint requires the same authentication as the pack endpoint. Signature must be verified against the content digest, not just presence.</p> <h3 id=64-key-trust-model-normative>6.4 Key Trust Model (NORMATIVE)<a class=headerlink href=#64-key-trust-model-normative title="Permanent link">&para;</a></h3> <p>TLS + registry allowlist is necessary but insufficient for enterprise trust.</p> <h4 id=641-trust-roots-normative>6.4.1 Trust Roots (NORMATIVE)<a class=headerlink href=#641-trust-roots-normative title="Permanent link">&para;</a></h4> <p><strong>Hierarchy:</strong></p> <ol> <li><strong>Embedded roots (baseline)</strong> — The CLI binary MAY ship with a set of pinned root public key IDs (e.g. Assay production signing keys). These are used to verify the registry keys manifest (§6.4.2). No TOFU: keys manifest MUST be signed by an embedded root (or by a key from config, see below).</li> <li><strong>Config roots (add/override)</strong> — User or deployment can add roots via config (e.g. <code>~/.assay/config.toml</code> or <code>ASSAY_REGISTRY_TRUST_ROOTS</code>). <strong>Default combine strategy (NORMATIVE):</strong> embedded ∪ config (union). All listed roots are trusted. An optional <strong>override</strong> mode (config-only, ignoring embedded) is permitted only when explicitly set (e.g. <code>registry.trust.mode = "override"</code>); implementations MUST document this and SHOULD require explicit opt-in to avoid accidentally disabling embedded roots (e.g. in CI images).</li> <li><strong>Keys manifest</strong> — Pack-signing keys in the <code>/keys</code> manifest are verified by (embedded or config) roots. Only keys that chain to a root are trusted for pack signature verification.</li> </ol> <p><strong>Example config (informative):</strong></p> <div class="language-toml highlight"><pre><span></span><code><span id=__span-26-1><a id=__codelineno-26-1 name=__codelineno-26-1 href=#__codelineno-26-1></a><span class=c1># ~/.assay/config.toml — optional; embedded roots suffice for default registry</span>
</span><span id=__span-26-2><a id=__codelineno-26-2 name=__codelineno-26-2 href=#__codelineno-26-2></a><span class=k>[registry.trust]</span>
</span><span id=__span-26-3><a id=__codelineno-26-3 name=__codelineno-26-3 href=#__codelineno-26-3></a><span class=n>roots</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-26-4><a id=__codelineno-26-4 name=__codelineno-26-4 href=#__codelineno-26-4></a><span class=w>  </span><span class=s2>&quot;sha256:abc123...&quot;</span><span class=p>,</span><span class=w>  </span><span class=c1># Assay signing key 2026</span>
</span><span id=__span-26-5><a id=__codelineno-26-5 name=__codelineno-26-5 href=#__codelineno-26-5></a><span class=w>  </span><span class=s2>&quot;sha256:def456...&quot;</span><span class=p>,</span><span class=w>  </span><span class=c1># Assay signing key 2025 (rotation)</span>
</span><span id=__span-26-6><a id=__codelineno-26-6 name=__codelineno-26-6 href=#__codelineno-26-6></a><span class=p>]</span>
</span><span id=__span-26-7><a id=__codelineno-26-7 name=__codelineno-26-7 href=#__codelineno-26-7></a><span class=c1># Optional: mode = &quot;override&quot; to use only config roots (use with care)</span>
</span></code></pre></div> <h4 id=642-keys-manifest>6.4.2 Keys Manifest<a class=headerlink href=#642-keys-manifest title="Permanent link">&para;</a></h4> <p>Registry publishes a signed keys manifest at <code>/keys</code>:</p> <div class="language-http highlight"><pre><span></span><code><span id=__span-27-1><a id=__codelineno-27-1 name=__codelineno-27-1 href=#__codelineno-27-1></a><span class=nf>GET</span> <span class=nn>/keys</span> <span class=kr>HTTP</span><span class=o>/</span><span class=m>1.1</span>
</span><span id=__span-27-2><a id=__codelineno-27-2 name=__codelineno-27-2 href=#__codelineno-27-2></a><span class=na>Host</span><span class=o>:</span> <span class=l>registry.getassay.dev</span>
</span></code></pre></div> <p><strong>Response:</strong></p> <div class="language-json highlight"><pre><span></span><code><span id=__span-28-1><a id=__codelineno-28-1 name=__codelineno-28-1 href=#__codelineno-28-1></a><span class=p>{</span>
</span><span id=__span-28-2><a id=__codelineno-28-2 name=__codelineno-28-2 href=#__codelineno-28-2></a><span class=w>  </span><span class=nt>&quot;keys&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span>
</span><span id=__span-28-3><a id=__codelineno-28-3 name=__codelineno-28-3 href=#__codelineno-28-3></a><span class=w>    </span><span class=p>{</span>
</span><span id=__span-28-4><a id=__codelineno-28-4 name=__codelineno-28-4 href=#__codelineno-28-4></a><span class=w>      </span><span class=nt>&quot;id&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;sha256:abc123...&quot;</span><span class=p>,</span>
</span><span id=__span-28-5><a id=__codelineno-28-5 name=__codelineno-28-5 href=#__codelineno-28-5></a><span class=w>      </span><span class=nt>&quot;algorithm&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;Ed25519&quot;</span><span class=p>,</span>
</span><span id=__span-28-6><a id=__codelineno-28-6 name=__codelineno-28-6 href=#__codelineno-28-6></a><span class=w>      </span><span class=nt>&quot;public_key&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;base64-SPKI&gt;&quot;</span><span class=p>,</span>
</span><span id=__span-28-7><a id=__codelineno-28-7 name=__codelineno-28-7 href=#__codelineno-28-7></a><span class=w>      </span><span class=nt>&quot;not_before&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2026-01-01T00:00:00Z&quot;</span><span class=p>,</span>
</span><span id=__span-28-8><a id=__codelineno-28-8 name=__codelineno-28-8 href=#__codelineno-28-8></a><span class=w>      </span><span class=nt>&quot;not_after&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2027-01-01T00:00:00Z&quot;</span><span class=p>,</span>
</span><span id=__span-28-9><a id=__codelineno-28-9 name=__codelineno-28-9 href=#__codelineno-28-9></a><span class=w>      </span><span class=nt>&quot;usage&quot;</span><span class=p>:</span><span class=w> </span><span class=p>[</span><span class=s2>&quot;pack-signing&quot;</span><span class=p>]</span>
</span><span id=__span-28-10><a id=__codelineno-28-10 name=__codelineno-28-10 href=#__codelineno-28-10></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-28-11><a id=__codelineno-28-11 name=__codelineno-28-11 href=#__codelineno-28-11></a><span class=w>  </span><span class=p>],</span>
</span><span id=__span-28-12><a id=__codelineno-28-12 name=__codelineno-28-12 href=#__codelineno-28-12></a><span class=w>  </span><span class=nt>&quot;signature&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;&lt;DSSE envelope over this manifest&gt;&quot;</span>
</span><span id=__span-28-13><a id=__codelineno-28-13 name=__codelineno-28-13 href=#__codelineno-28-13></a><span class=p>}</span>
</span></code></pre></div> <p><strong>Manifest signature (NORMATIVE):</strong> The keys manifest DSSE envelope MUST use <code>payloadType</code> exactly <code>application/vnd.assay.registry.keys.v1+json</code>. The DSSE payload is the UTF-8 bytes of the JSON response body as served (no additional JCS canonicalization); authenticity is provided by the DSSE signature. The manifest MUST be signed by a key whose key id is listed in the client's trust roots (embedded or config). Implementations MUST verify the manifest signature against one of those roots before trusting any key in <code>keys[]</code>.</p> <p><strong>Verification:</strong></p> <ol> <li>CLI fetches <code>/keys</code> manifest</li> <li>Verifies manifest signature against pinned root</li> <li>Caches manifest (TTL from <code>Cache-Control</code>, default 24h)</li> <li>Uses manifest keys to verify pack signatures</li> </ol> <p>This provides: - Key rotation without CLI updates - No TOFU (Trust On First Use) - Explicit validity periods</p> <h4 id=643-trust-hierarchy>6.4.3 Trust Hierarchy<a class=headerlink href=#643-trust-hierarchy title="Permanent link">&para;</a></h4> <table> <thead> <tr> <th>Source</th> <th>Trust Level</th> </tr> </thead> <tbody> <tr> <td>Pinned root (CLI binary)</td> <td>Highest - verifies keys manifest</td> </tr> <tr> <td>Keys manifest entry</td> <td>High - verified by root</td> </tr> <tr> <td>Config-provided key</td> <td>High - explicit user trust</td> </tr> <tr> <td>Unknown key</td> <td>MUST reject for commercial</td> </tr> </tbody> </table> <h3 id=65-keyless-signing-future>6.5 Keyless Signing (Future)<a class=headerlink href=#65-keyless-signing-future title="Permanent link">&para;</a></h3> <p>For OIDC-based keyless signing (Sigstore/Fulcio model):</p> <div class="language-http highlight"><pre><span></span><code><span id=__span-29-1><a id=__codelineno-29-1 name=__codelineno-29-1 href=#__codelineno-29-1></a><span class=err>X-Pack-Signature: &lt;DSSE envelope with certificate&gt;</span>
</span><span id=__span-29-2><a id=__codelineno-29-2 name=__codelineno-29-2 href=#__codelineno-29-2></a><span class=err>X-Pack-Certificate: &lt;base64-Fulcio-cert&gt;</span>
</span><span id=__span-29-3><a id=__codelineno-29-3 name=__codelineno-29-3 href=#__codelineno-29-3></a><span class=err>X-Pack-Transparency-Log: &lt;rekor-entry-url&gt;</span>
</span></code></pre></div> <p>This is planned for v1.1 and aligns with the attestation positioning in ADR-018.</p> <hr> <h2 id=7-caching>7. Caching<a class=headerlink href=#7-caching title="Permanent link">&para;</a></h2> <h3 id=71-local-cache>7.1 Local Cache<a class=headerlink href=#71-local-cache title="Permanent link">&para;</a></h3> <p>Cache layout MUST avoid collisions when multiple registries or namespaces are used. Recommended structure:</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-30-1><a id=__codelineno-30-1 name=__codelineno-30-1 href=#__codelineno-30-1></a>~/.assay/cache/packs/{registry_id}/{namespace}/{name}/{version}/pack.yaml
</span><span id=__span-30-2><a id=__codelineno-30-2 name=__codelineno-30-2 href=#__codelineno-30-2></a>~/.assay/cache/packs/{registry_id}/{namespace}/{name}/{version}/metadata.json
</span><span id=__span-30-3><a id=__codelineno-30-3 name=__codelineno-30-3 href=#__codelineno-30-3></a>~/.assay/cache/packs/{registry_id}/{namespace}/{name}/{version}/signature.json
</span></code></pre></div> <p>Where <code>registry_id</code> is a stable identifier for the registry (e.g. hostname or hash of base URL) and <code>namespace</code> is the org path if present (e.g. <code>orgs/acme</code> or <code>_global</code>). For a single default registry and no namespace, implementations MAY use the shorter path <code>~/.assay/cache/packs/{name}/{version}/</code> for backward compatibility, but MUST document that adding a second registry or namespace requires the extended path to avoid privilege mixing.</p> <p><strong>metadata.json:</strong></p> <div class="language-json highlight"><pre><span></span><code><span id=__span-31-1><a id=__codelineno-31-1 name=__codelineno-31-1 href=#__codelineno-31-1></a><span class=p>{</span>
</span><span id=__span-31-2><a id=__codelineno-31-2 name=__codelineno-31-2 href=#__codelineno-31-2></a><span class=w>  </span><span class=nt>&quot;fetched_at&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2026-01-29T10:00:00Z&quot;</span><span class=p>,</span>
</span><span id=__span-31-3><a id=__codelineno-31-3 name=__codelineno-31-3 href=#__codelineno-31-3></a><span class=w>  </span><span class=nt>&quot;digest&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;sha256:abc123...&quot;</span><span class=p>,</span>
</span><span id=__span-31-4><a id=__codelineno-31-4 name=__codelineno-31-4 href=#__codelineno-31-4></a><span class=w>  </span><span class=nt>&quot;etag&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;\&quot;sha256:abc123...\&quot;&quot;</span><span class=p>,</span>
</span><span id=__span-31-5><a id=__codelineno-31-5 name=__codelineno-31-5 href=#__codelineno-31-5></a><span class=w>  </span><span class=nt>&quot;expires_at&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;2026-01-30T10:00:00Z&quot;</span><span class=p>,</span>
</span><span id=__span-31-6><a id=__codelineno-31-6 name=__codelineno-31-6 href=#__codelineno-31-6></a><span class=w>  </span><span class=nt>&quot;registry_url&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;https://registry.getassay.dev/v1&quot;</span><span class=p>,</span>
</span><span id=__span-31-7><a id=__codelineno-31-7 name=__codelineno-31-7 href=#__codelineno-31-7></a><span class=w>  </span><span class=nt>&quot;policy&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;commercial&quot;</span><span class=p>,</span>
</span><span id=__span-31-8><a id=__codelineno-31-8 name=__codelineno-31-8 href=#__codelineno-31-8></a><span class=w>  </span><span class=nt>&quot;key_id&quot;</span><span class=p>:</span><span class=w> </span><span class=s2>&quot;sha256:def456...&quot;</span>
</span><span id=__span-31-9><a id=__codelineno-31-9 name=__codelineno-31-9 href=#__codelineno-31-9></a><span class=p>}</span>
</span></code></pre></div> <p><code>policy</code> MUST be the value of <code>X-Pack-Policy</code> from the response (used on cache read to decide signature requirement).</p> <p><strong>signature.json:</strong></p> <p>Cached DSSE envelope for offline verification.</p> <h3 id=72-cache-integrity-verification-normative>7.2 Cache Integrity Verification (NORMATIVE)<a class=headerlink href=#72-cache-integrity-verification-normative title="Permanent link">&para;</a></h3> <p><strong>On every cache read</strong>, CLI MUST verify integrity before use:</p> <div class="language-rust highlight"><pre><span></span><code><span id=__span-32-1><a id=__codelineno-32-1 name=__codelineno-32-1 href=#__codelineno-32-1></a><span class=k>fn</span><span class=w> </span><span class=nf>load_cached_pack</span><span class=p>(</span><span class=n>name</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=kt>str</span><span class=p>,</span><span class=w> </span><span class=n>version</span><span class=p>:</span><span class=w> </span><span class=kp>&amp;</span><span class=kt>str</span><span class=p>)</span><span class=w> </span><span class=p>-&gt;</span><span class=w> </span><span class=nb>Result</span><span class=o>&lt;</span><span class=n>Pack</span><span class=o>&gt;</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-32-2><a id=__codelineno-32-2 name=__codelineno-32-2 href=#__codelineno-32-2></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>cache_dir</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>cache_path</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>version</span><span class=p>);</span>
</span><span id=__span-32-3><a id=__codelineno-32-3 name=__codelineno-32-3 href=#__codelineno-32-3></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>content</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>fs</span><span class=p>::</span><span class=n>read</span><span class=p>(</span><span class=n>cache_dir</span><span class=p>.</span><span class=n>join</span><span class=p>(</span><span class=s>&quot;pack.yaml&quot;</span><span class=p>))</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-32-4><a id=__codelineno-32-4 name=__codelineno-32-4 href=#__codelineno-32-4></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>metadata</span><span class=p>:</span><span class=w> </span><span class=nc>Metadata</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>load_json</span><span class=p>(</span><span class=n>cache_dir</span><span class=p>.</span><span class=n>join</span><span class=p>(</span><span class=s>&quot;metadata.json&quot;</span><span class=p>))</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-32-5><a id=__codelineno-32-5 name=__codelineno-32-5 href=#__codelineno-32-5></a>
</span><span id=__span-32-6><a id=__codelineno-32-6 name=__codelineno-32-6 href=#__codelineno-32-6></a><span class=w>    </span><span class=c1>// 1. Verify digest (guards against disk corruption/tampering)</span>
</span><span id=__span-32-7><a id=__codelineno-32-7 name=__codelineno-32-7 href=#__codelineno-32-7></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>canonical</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>jcs_canonicalize</span><span class=p>(</span><span class=n>parse_yaml_strict</span><span class=p>(</span><span class=o>&amp;</span><span class=n>content</span><span class=p>)</span><span class=o>?</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-32-8><a id=__codelineno-32-8 name=__codelineno-32-8 href=#__codelineno-32-8></a><span class=w>    </span><span class=kd>let</span><span class=w> </span><span class=n>computed</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=fm>format!</span><span class=p>(</span><span class=s>&quot;sha256:{}&quot;</span><span class=p>,</span><span class=w> </span><span class=n>sha256_hex</span><span class=p>(</span><span class=o>&amp;</span><span class=n>canonical</span><span class=p>));</span>
</span><span id=__span-32-9><a id=__codelineno-32-9 name=__codelineno-32-9 href=#__codelineno-32-9></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>computed</span><span class=w> </span><span class=o>!=</span><span class=w> </span><span class=n>metadata</span><span class=p>.</span><span class=n>digest</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-32-10><a id=__codelineno-32-10 name=__codelineno-32-10 href=#__codelineno-32-10></a><span class=w>        </span><span class=c1>// Cache corrupted - evict and re-fetch</span>
</span><span id=__span-32-11><a id=__codelineno-32-11 name=__codelineno-32-11 href=#__codelineno-32-11></a><span class=w>        </span><span class=n>evict_cache</span><span class=p>(</span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>version</span><span class=p>);</span>
</span><span id=__span-32-12><a id=__codelineno-32-12 name=__codelineno-32-12 href=#__codelineno-32-12></a><span class=w>        </span><span class=k>return</span><span class=w> </span><span class=nb>Err</span><span class=p>(</span><span class=n>CacheCorrupted</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>version</span><span class=w> </span><span class=p>});</span>
</span><span id=__span-32-13><a id=__codelineno-32-13 name=__codelineno-32-13 href=#__codelineno-32-13></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-32-14><a id=__codelineno-32-14 name=__codelineno-32-14 href=#__codelineno-32-14></a>
</span><span id=__span-32-15><a id=__codelineno-32-15 name=__codelineno-32-15 href=#__codelineno-32-15></a><span class=w>    </span><span class=c1>// 2. Signature: for commercial packs, signature MUST be present and valid (see §6.3)</span>
</span><span id=__span-32-16><a id=__codelineno-32-16 name=__codelineno-32-16 href=#__codelineno-32-16></a><span class=w>    </span><span class=k>if</span><span class=w> </span><span class=n>pack_requires_signature</span><span class=p>(</span><span class=o>&amp;</span><span class=n>metadata</span><span class=p>)</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-32-17><a id=__codelineno-32-17 name=__codelineno-32-17 href=#__codelineno-32-17></a><span class=w>        </span><span class=kd>let</span><span class=w> </span><span class=n>envelope</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>load_json</span><span class=p>::</span><span class=o>&lt;</span><span class=n>DsseEnvelope</span><span class=o>&gt;</span><span class=p>(</span><span class=n>cache_dir</span><span class=p>.</span><span class=n>join</span><span class=p>(</span><span class=s>&quot;signature.json&quot;</span><span class=p>))</span>
</span><span id=__span-32-18><a id=__codelineno-32-18 name=__codelineno-32-18 href=#__codelineno-32-18></a><span class=w>            </span><span class=p>.</span><span class=n>map_err</span><span class=p>(</span><span class=o>|</span><span class=n>_</span><span class=o>|</span><span class=w> </span><span class=n>PackError</span><span class=p>::</span><span class=n>MissingSignature</span><span class=w> </span><span class=p>{</span><span class=w> </span><span class=n>name</span><span class=p>,</span><span class=w> </span><span class=n>version</span><span class=w> </span><span class=p>})</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-32-19><a id=__codelineno-32-19 name=__codelineno-32-19 href=#__codelineno-32-19></a><span class=w>        </span><span class=n>verify_dsse</span><span class=p>(</span><span class=o>&amp;</span><span class=n>envelope</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>canonical</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>trust_store</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-32-20><a id=__codelineno-32-20 name=__codelineno-32-20 href=#__codelineno-32-20></a><span class=w>    </span><span class=p>}</span><span class=w> </span><span class=k>else</span><span class=w> </span><span class=k>if</span><span class=w> </span><span class=kd>let</span><span class=w> </span><span class=nb>Ok</span><span class=p>(</span><span class=n>envelope</span><span class=p>)</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=n>load_json</span><span class=p>::</span><span class=o>&lt;</span><span class=n>DsseEnvelope</span><span class=o>&gt;</span><span class=p>(</span><span class=n>cache_dir</span><span class=p>.</span><span class=n>join</span><span class=p>(</span><span class=s>&quot;signature.json&quot;</span><span class=p>))</span><span class=w> </span><span class=p>{</span>
</span><span id=__span-32-21><a id=__codelineno-32-21 name=__codelineno-32-21 href=#__codelineno-32-21></a><span class=w>        </span><span class=n>verify_dsse</span><span class=p>(</span><span class=o>&amp;</span><span class=n>envelope</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>canonical</span><span class=p>,</span><span class=w> </span><span class=o>&amp;</span><span class=n>trust_store</span><span class=p>)</span><span class=o>?</span><span class=p>;</span>
</span><span id=__span-32-22><a id=__codelineno-32-22 name=__codelineno-32-22 href=#__codelineno-32-22></a><span class=w>    </span><span class=p>}</span>
</span><span id=__span-32-23><a id=__codelineno-32-23 name=__codelineno-32-23 href=#__codelineno-32-23></a>
</span><span id=__span-32-24><a id=__codelineno-32-24 name=__codelineno-32-24 href=#__codelineno-32-24></a><span class=w>    </span><span class=n>parse_pack</span><span class=p>(</span><span class=o>&amp;</span><span class=n>content</span><span class=p>)</span>
</span><span id=__span-32-25><a id=__codelineno-32-25 name=__codelineno-32-25 href=#__codelineno-32-25></a><span class=p>}</span>
</span></code></pre></div> <p><strong>Commercial packs (NORMATIVE):</strong> The client MUST record <code>X-Pack-Policy</code> (or equivalent) in cache metadata when storing a pack. On cache read, when metadata indicates <code>policy: commercial</code> (or signature required per §6.3), missing or invalid <code>signature.json</code> MUST result in failure: evict cache and re-fetch, or return error. The client MUST NOT use the pack without a valid signature.</p> <p><strong>Rationale</strong>: Local disk is not trusted. Malware, disk errors, or user mistakes could modify cached packs.</p> <h3 id=73-cache-invalidation>7.3 Cache Invalidation<a class=headerlink href=#73-cache-invalidation title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Scenario</th> <th>Behavior</th> </tr> </thead> <tbody> <tr> <td>Cache hit, not expired, integrity OK</td> <td>Use cached</td> </tr> <tr> <td>Cache hit, not expired, integrity FAIL</td> <td>Evict, re-fetch</td> </tr> <tr> <td>Cache hit, expired</td> <td>Re-fetch with <code>If-None-Match</code>, verify</td> </tr> <tr> <td>Cache miss</td> <td>Fetch, verify, cache</td> </tr> <tr> <td><code>--no-cache</code> flag</td> <td>Always fetch, verify</td> </tr> </tbody> </table> <h3 id=74-cache-ttl>7.4 Cache TTL<a class=headerlink href=#74-cache-ttl title="Permanent link">&para;</a></h3> <p>Default: 24 hours (86400 seconds), overridable via <code>Cache-Control</code> header.</p> <p><strong>Cache-Control requirements:</strong></p> <table> <thead> <tr> <th>Pack Type</th> <th>Cache-Control</th> <th>Vary</th> </tr> </thead> <tbody> <tr> <td>Commercial (authenticated)</td> <td><code>private, max-age=86400</code></td> <td><code>Authorization, Accept-Encoding</code></td> </tr> <tr> <td>Open (unauthenticated)</td> <td><code>public, max-age=86400</code></td> <td><code>Accept-Encoding</code></td> </tr> </tbody> </table> <blockquote> <p><strong>Security note</strong>: Commercial packs MUST use <code>Cache-Control: private</code> and <code>Vary: Authorization</code> to prevent caching by intermediate proxies that don't understand authorization context.</p> </blockquote> <hr> <h2 id=8-lockfile>8. Lockfile<a class=headerlink href=#8-lockfile title="Permanent link">&para;</a></h2> <h3 id=81-purpose>8.1 Purpose<a class=headerlink href=#81-purpose title="Permanent link">&para;</a></h3> <p>Enterprise pipelines need reproducible builds. The lockfile captures resolved pack references with full verification metadata.</p> <h3 id=82-lockfile-format>8.2 Lockfile Format<a class=headerlink href=#82-lockfile-format title="Permanent link">&para;</a></h3> <p><strong>Filename</strong>: <code>assay.packs.lock</code> (or <code>assay.lock</code> with <code>[packs]</code> section)</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-33-1><a id=__codelineno-33-1 name=__codelineno-33-1 href=#__codelineno-33-1></a><span class=c1># assay.packs.lock</span>
</span><span id=__span-33-2><a id=__codelineno-33-2 name=__codelineno-33-2 href=#__codelineno-33-2></a><span class=c1># DO NOT EDIT - Generated by assay pack lock</span>
</span><span id=__span-33-3><a id=__codelineno-33-3 name=__codelineno-33-3 href=#__codelineno-33-3></a><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id=__span-33-4><a id=__codelineno-33-4 name=__codelineno-33-4 href=#__codelineno-33-4></a><span class=nt>generated_at</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2026-01-29T10:00:00Z&quot;</span>
</span><span id=__span-33-5><a id=__codelineno-33-5 name=__codelineno-33-5 href=#__codelineno-33-5></a><span class=nt>generated_by</span><span class=p>:</span><span class=w> </span><span class=s>&quot;assay-cli/2.12.0&quot;</span>
</span><span id=__span-33-6><a id=__codelineno-33-6 name=__codelineno-33-6 href=#__codelineno-33-6></a>
</span><span id=__span-33-7><a id=__codelineno-33-7 name=__codelineno-33-7 href=#__codelineno-33-7></a><span class=nt>packs</span><span class=p>:</span>
</span><span id=__span-33-8><a id=__codelineno-33-8 name=__codelineno-33-8 href=#__codelineno-33-8></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">eu-ai-act-pro</span>
</span><span id=__span-33-9><a id=__codelineno-33-9 name=__codelineno-33-9 href=#__codelineno-33-9></a><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1.2.0&quot;</span>
</span><span id=__span-33-10><a id=__codelineno-33-10 name=__codelineno-33-10 href=#__codelineno-33-10></a><span class=w>    </span><span class=nt>digest</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sha256:abc123...</span>
</span><span id=__span-33-11><a id=__codelineno-33-11 name=__codelineno-33-11 href=#__codelineno-33-11></a><span class=w>    </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">registry</span>
</span><span id=__span-33-12><a id=__codelineno-33-12 name=__codelineno-33-12 href=#__codelineno-33-12></a><span class=w>    </span><span class=nt>registry_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;https://registry.getassay.dev/v1&quot;</span>
</span><span id=__span-33-13><a id=__codelineno-33-13 name=__codelineno-33-13 href=#__codelineno-33-13></a><span class=w>    </span><span class=nt>namespace</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">null</span><span class=w>  </span><span class=c1># or &quot;orgs/acme&quot;</span>
</span><span id=__span-33-14><a id=__codelineno-33-14 name=__codelineno-33-14 href=#__codelineno-33-14></a><span class=w>    </span><span class=nt>fetched_at</span><span class=p>:</span><span class=w> </span><span class=s>&quot;2026-01-29T10:00:00Z&quot;</span>
</span><span id=__span-33-15><a id=__codelineno-33-15 name=__codelineno-33-15 href=#__codelineno-33-15></a><span class=w>    </span><span class=nt>etag</span><span class=p>:</span><span class=w> </span><span class=s>&quot;\&quot;sha256:abc123...\&quot;&quot;</span>
</span><span id=__span-33-16><a id=__codelineno-33-16 name=__codelineno-33-16 href=#__codelineno-33-16></a><span class=w>    </span><span class=nt>signature</span><span class=p>:</span>
</span><span id=__span-33-17><a id=__codelineno-33-17 name=__codelineno-33-17 href=#__codelineno-33-17></a><span class=w>      </span><span class=nt>algorithm</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Ed25519</span>
</span><span id=__span-33-18><a id=__codelineno-33-18 name=__codelineno-33-18 href=#__codelineno-33-18></a><span class=w>      </span><span class=nt>key_id</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sha256:def456...</span>
</span><span id=__span-33-19><a id=__codelineno-33-19 name=__codelineno-33-19 href=#__codelineno-33-19></a>
</span><span id=__span-33-20><a id=__codelineno-33-20 name=__codelineno-33-20 href=#__codelineno-33-20></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">eu-ai-act-baseline</span>
</span><span id=__span-33-21><a id=__codelineno-33-21 name=__codelineno-33-21 href=#__codelineno-33-21></a><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span>
</span><span id=__span-33-22><a id=__codelineno-33-22 name=__codelineno-33-22 href=#__codelineno-33-22></a><span class=w>    </span><span class=nt>digest</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sha256:789xyz...</span>
</span><span id=__span-33-23><a id=__codelineno-33-23 name=__codelineno-33-23 href=#__codelineno-33-23></a><span class=w>    </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">bundled</span>
</span><span id=__span-33-24><a id=__codelineno-33-24 name=__codelineno-33-24 href=#__codelineno-33-24></a>
</span><span id=__span-33-25><a id=__codelineno-33-25 name=__codelineno-33-25 href=#__codelineno-33-25></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">custom-rules</span>
</span><span id=__span-33-26><a id=__codelineno-33-26 name=__codelineno-33-26 href=#__codelineno-33-26></a><span class=w>    </span><span class=nt>version</span><span class=p>:</span><span class=w> </span><span class=s>&quot;1.0.0&quot;</span>
</span><span id=__span-33-27><a id=__codelineno-33-27 name=__codelineno-33-27 href=#__codelineno-33-27></a><span class=w>    </span><span class=nt>digest</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">sha256:qrs789...</span>
</span><span id=__span-33-28><a id=__codelineno-33-28 name=__codelineno-33-28 href=#__codelineno-33-28></a><span class=w>    </span><span class=nt>source</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">byos</span>
</span><span id=__span-33-29><a id=__codelineno-33-29 name=__codelineno-33-29 href=#__codelineno-33-29></a><span class=w>    </span><span class=nt>byos_url</span><span class=p>:</span><span class=w> </span><span class=s>&quot;s3://my-bucket/packs/custom.yaml&quot;</span>
</span></code></pre></div> <p><strong>Version 2 fields (new):</strong></p> <table> <thead> <tr> <th>Field</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code>registry_url</code></td> <td>Exact registry used (for multi-registry setups)</td> </tr> <tr> <td><code>namespace</code></td> <td>Organization namespace if used</td> </tr> <tr> <td><code>etag</code></td> <td>HTTP ETag for conditional requests</td> </tr> <tr> <td><code>signature.algorithm</code></td> <td>Signature algorithm (future-proofing)</td> </tr> <tr> <td><code>byos_url</code></td> <td>BYOS source URL (for BYOS packs)</td> </tr> </tbody> </table> <h3 id=83-cli-commands>8.3 CLI Commands<a class=headerlink href=#83-cli-commands title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-34-1><a id=__codelineno-34-1 name=__codelineno-34-1 href=#__codelineno-34-1></a><span class=c1># Generate/update lockfile from current packs</span>
</span><span id=__span-34-2><a id=__codelineno-34-2 name=__codelineno-34-2 href=#__codelineno-34-2></a>assay<span class=w> </span>pack<span class=w> </span>lock
</span><span id=__span-34-3><a id=__codelineno-34-3 name=__codelineno-34-3 href=#__codelineno-34-3></a>
</span><span id=__span-34-4><a id=__codelineno-34-4 name=__codelineno-34-4 href=#__codelineno-34-4></a><span class=c1># Verify current packs match lockfile (digest + signature)</span>
</span><span id=__span-34-5><a id=__codelineno-34-5 name=__codelineno-34-5 href=#__codelineno-34-5></a>assay<span class=w> </span>pack<span class=w> </span>lock<span class=w> </span>--verify
</span><span id=__span-34-6><a id=__codelineno-34-6 name=__codelineno-34-6 href=#__codelineno-34-6></a>
</span><span id=__span-34-7><a id=__codelineno-34-7 name=__codelineno-34-7 href=#__codelineno-34-7></a><span class=c1># CI mode: fail if lockfile outdated or verification fails</span>
</span><span id=__span-34-8><a id=__codelineno-34-8 name=__codelineno-34-8 href=#__codelineno-34-8></a>assay<span class=w> </span>pack<span class=w> </span>lock<span class=w> </span>--check
</span><span id=__span-34-9><a id=__codelineno-34-9 name=__codelineno-34-9 href=#__codelineno-34-9></a>
</span><span id=__span-34-10><a id=__codelineno-34-10 name=__codelineno-34-10 href=#__codelineno-34-10></a><span class=c1># Update lockfile (re-fetch all, update digests)</span>
</span><span id=__span-34-11><a id=__codelineno-34-11 name=__codelineno-34-11 href=#__codelineno-34-11></a>assay<span class=w> </span>pack<span class=w> </span>lock<span class=w> </span>--update
</span></code></pre></div> <h3 id=84-lockfile-behavior>8.4 Lockfile Behavior<a class=headerlink href=#84-lockfile-behavior title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Flag</th> <th>Behavior</th> </tr> </thead> <tbody> <tr> <td>(none)</td> <td>Create lockfile if missing, error if exists and outdated</td> </tr> <tr> <td><code>--verify</code></td> <td>Verify all packs match lockfile, exit 0/1</td> </tr> <tr> <td><code>--check</code></td> <td>Verify + fail if lockfile needs update (CI mode)</td> </tr> <tr> <td><code>--update</code></td> <td>Re-fetch all packs, update lockfile</td> </tr> </tbody> </table> <h3 id=85-ci-integration>8.5 CI Integration<a class=headerlink href=#85-ci-integration title="Permanent link">&para;</a></h3> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-35-1><a id=__codelineno-35-1 name=__codelineno-35-1 href=#__codelineno-35-1></a><span class=nt>steps</span><span class=p>:</span>
</span><span id=__span-35-2><a id=__codelineno-35-2 name=__codelineno-35-2 href=#__codelineno-35-2></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Verify pack lockfile</span>
</span><span id=__span-35-3><a id=__codelineno-35-3 name=__codelineno-35-3 href=#__codelineno-35-3></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">assay pack lock --check</span>
</span><span id=__span-35-4><a id=__codelineno-35-4 name=__codelineno-35-4 href=#__codelineno-35-4></a>
</span><span id=__span-35-5><a id=__codelineno-35-5 name=__codelineno-35-5 href=#__codelineno-35-5></a><span class=w>  </span><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Lint with locked packs</span>
</span><span id=__span-35-6><a id=__codelineno-35-6 name=__codelineno-35-6 href=#__codelineno-35-6></a><span class=w>    </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">assay evidence lint --pack eu-ai-act-pro@1.2.0 bundle.tar.gz</span>
</span></code></pre></div> <p><strong>Lockfile enforcement (NORMATIVE):</strong></p> <p>When <code>assay.packs.lock</code> exists:</p> <table> <thead> <tr> <th>Scenario</th> <th>Behavior</th> </tr> </thead> <tbody> <tr> <td>Digest matches</td> <td>Use pack</td> </tr> <tr> <td>Digest differs</td> <td>Error with diff, suggest <code>--update</code></td> </tr> <tr> <td>Pack missing from lockfile</td> <td>Error, suggest <code>assay pack lock</code></td> </tr> <tr> <td>Pack in lockfile but not requested</td> <td>Warning only</td> </tr> </tbody> </table> <h3 id=86-security-revocation-handling>8.6 Security Revocation Handling<a class=headerlink href=#86-security-revocation-handling title="Permanent link">&para;</a></h3> <p>If a locked pack version is revoked (410):</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-36-1><a id=__codelineno-36-1 name=__codelineno-36-1 href=#__codelineno-36-1></a>Error: Pack &#39;eu-ai-act-pro@1.1.0&#39; in lockfile has been revoked.
</span><span id=__span-36-2><a id=__codelineno-36-2 name=__codelineno-36-2 href=#__codelineno-36-2></a>
</span><span id=__span-36-3><a id=__codelineno-36-3 name=__codelineno-36-3 href=#__codelineno-36-3></a>Reason: CVE-2026-1234 - rule bypass vulnerability
</span><span id=__span-36-4><a id=__codelineno-36-4 name=__codelineno-36-4 href=#__codelineno-36-4></a>Safe version: 1.2.1
</span><span id=__span-36-5><a id=__codelineno-36-5 name=__codelineno-36-5 href=#__codelineno-36-5></a>
</span><span id=__span-36-6><a id=__codelineno-36-6 name=__codelineno-36-6 href=#__codelineno-36-6></a>To update lockfile: assay pack lock --update
</span><span id=__span-36-7><a id=__codelineno-36-7 name=__codelineno-36-7 href=#__codelineno-36-7></a>To proceed anyway: assay pack lock --allow-revoked  # forensics only
</span></code></pre></div> <hr> <h2 id=9-byos-pack-storage>9. BYOS Pack Storage<a class=headerlink href=#9-byos-pack-storage title="Permanent link">&para;</a></h2> <p>Users can host packs in their own storage:</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-37-1><a id=__codelineno-37-1 name=__codelineno-37-1 href=#__codelineno-37-1></a><span class=c1># S3</span>
</span><span id=__span-37-2><a id=__codelineno-37-2 name=__codelineno-37-2 href=#__codelineno-37-2></a>assay<span class=w> </span>evidence<span class=w> </span>lint<span class=w> </span>--pack<span class=w> </span>s3://my-bucket/packs/custom.yaml<span class=w> </span>bundle.tar.gz
</span><span id=__span-37-3><a id=__codelineno-37-3 name=__codelineno-37-3 href=#__codelineno-37-3></a>
</span><span id=__span-37-4><a id=__codelineno-37-4 name=__codelineno-37-4 href=#__codelineno-37-4></a><span class=c1># GCS</span>
</span><span id=__span-37-5><a id=__codelineno-37-5 name=__codelineno-37-5 href=#__codelineno-37-5></a>assay<span class=w> </span>evidence<span class=w> </span>lint<span class=w> </span>--pack<span class=w> </span>gs://my-bucket/packs/custom.yaml<span class=w> </span>bundle.tar.gz
</span><span id=__span-37-6><a id=__codelineno-37-6 name=__codelineno-37-6 href=#__codelineno-37-6></a>
</span><span id=__span-37-7><a id=__codelineno-37-7 name=__codelineno-37-7 href=#__codelineno-37-7></a><span class=c1># Azure</span>
</span><span id=__span-37-8><a id=__codelineno-37-8 name=__codelineno-37-8 href=#__codelineno-37-8></a>assay<span class=w> </span>evidence<span class=w> </span>lint<span class=w> </span>--pack<span class=w> </span>az://container/packs/custom.yaml<span class=w> </span>bundle.tar.gz
</span></code></pre></div> <p><strong>Authentication</strong>: Uses same OIDC/credentials as BYOS evidence push.</p> <p><strong>Integrity</strong>: BYOS packs SHOULD provide a signature when possible. Signature and digest semantics are implementation-defined for BYOS (e.g. object metadata, sidecar file, or a well-known YAML field such as <code>x-assay-sig</code> in the pack root for inline signature reference). The <strong>canonical spelling</strong> for a pack-root YAML field, if used, is <code>x-assay-sig</code> (lowercase, hyphen). The client MUST have an expected digest to verify against: either a <strong>pinned ref</strong> (e.g. <code>s3://bucket/packs/custom.yaml#sha256:...</code>) or an entry in <code>assay.packs.lock</code> with <code>source: byos</code> and <code>digest</code>. Use of BYOS without a pin or lockfile SHOULD trigger a warning; implementations MAY reject or allow with downgraded assurance.</p> <hr> <h2 id=10-error-messages>10. Error Messages<a class=headerlink href=#10-error-messages title="Permanent link">&para;</a></h2> <h3 id=101-user-facing-errors>10.1 User-Facing Errors<a class=headerlink href=#101-user-facing-errors title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>Error</th> <th>Message</th> </tr> </thead> <tbody> <tr> <td>Not found</td> <td><code>Pack 'eu-ai-act-pro@1.2.0' not found. Check pack name and version.</code></td> </tr> <tr> <td>Auth required</td> <td><code>Pack 'eu-ai-act-pro' requires authentication. Set ASSAY_REGISTRY_TOKEN or configure OIDC.</code></td> </tr> <tr> <td>Not licensed</td> <td><code>Pack 'eu-ai-act-pro' is not included in your license. Contact sales@getassay.dev</code></td> </tr> <tr> <td>Digest mismatch</td> <td><code>Pack integrity check failed. Expected sha256:abc..., got sha256:def...</code></td> </tr> <tr> <td>Deprecated</td> <td><code>Pack 'eu-ai-act-pro@1.1.0' is deprecated. Use @1.2.0 instead.</code></td> </tr> </tbody> </table> <h3 id=102-github-action-error>10.2 GitHub Action Error<a class=headerlink href=#102-github-action-error title="Permanent link">&para;</a></h3> <p>When registry fetch fails in Action context:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-38-1><a id=__codelineno-38-1 name=__codelineno-38-1 href=#__codelineno-38-1></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>name</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">Lint with pack</span>
</span><span id=__span-38-2><a id=__codelineno-38-2 name=__codelineno-38-2 href=#__codelineno-38-2></a><span class=w>  </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-38-3><a id=__codelineno-38-3 name=__codelineno-38-3 href=#__codelineno-38-3></a><span class=w>    </span><span class=no>if ! assay evidence lint --pack eu-ai-act-pro@1.2.0 bundle.tar.gz; then</span>
</span><span id=__span-38-4><a id=__codelineno-38-4 name=__codelineno-38-4 href=#__codelineno-38-4></a><span class=w>      </span><span class=no>echo &quot;::error::Pack fetch failed. See https://getassay.dev/docs/enterprise-packs&quot;</span>
</span><span id=__span-38-5><a id=__codelineno-38-5 name=__codelineno-38-5 href=#__codelineno-38-5></a><span class=w>      </span><span class=no>exit 1</span>
</span><span id=__span-38-6><a id=__codelineno-38-6 name=__codelineno-38-6 href=#__codelineno-38-6></a><span class=w>    </span><span class=no>fi</span>
</span></code></pre></div> <hr> <h2 id=11-cli-implementation>11. CLI Implementation<a class=headerlink href=#11-cli-implementation title="Permanent link">&para;</a></h2> <h3 id=111-config-commands>11.1 Config Commands<a class=headerlink href=#111-config-commands title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-39-1><a id=__codelineno-39-1 name=__codelineno-39-1 href=#__codelineno-39-1></a><span class=c1># Set registry token</span>
</span><span id=__span-39-2><a id=__codelineno-39-2 name=__codelineno-39-2 href=#__codelineno-39-2></a>assay<span class=w> </span>config<span class=w> </span><span class=nb>set</span><span class=w> </span>registry.token<span class=w> </span>ast_...
</span><span id=__span-39-3><a id=__codelineno-39-3 name=__codelineno-39-3 href=#__codelineno-39-3></a>
</span><span id=__span-39-4><a id=__codelineno-39-4 name=__codelineno-39-4 href=#__codelineno-39-4></a><span class=c1># Set custom registry URL</span>
</span><span id=__span-39-5><a id=__codelineno-39-5 name=__codelineno-39-5 href=#__codelineno-39-5></a>assay<span class=w> </span>config<span class=w> </span><span class=nb>set</span><span class=w> </span>registry.url<span class=w> </span>https://registry.example.com/v1
</span><span id=__span-39-6><a id=__codelineno-39-6 name=__codelineno-39-6 href=#__codelineno-39-6></a>
</span><span id=__span-39-7><a id=__codelineno-39-7 name=__codelineno-39-7 href=#__codelineno-39-7></a><span class=c1># Clear cache</span>
</span><span id=__span-39-8><a id=__codelineno-39-8 name=__codelineno-39-8 href=#__codelineno-39-8></a>assay<span class=w> </span>cache<span class=w> </span>clear<span class=w> </span>packs
</span><span id=__span-39-9><a id=__codelineno-39-9 name=__codelineno-39-9 href=#__codelineno-39-9></a>
</span><span id=__span-39-10><a id=__codelineno-39-10 name=__codelineno-39-10 href=#__codelineno-39-10></a><span class=c1># List cached packs</span>
</span><span id=__span-39-11><a id=__codelineno-39-11 name=__codelineno-39-11 href=#__codelineno-39-11></a>assay<span class=w> </span>cache<span class=w> </span>list<span class=w> </span>packs
</span></code></pre></div> <h3 id=112-fetch-command-optional>11.2 Fetch Command (Optional)<a class=headerlink href=#112-fetch-command-optional title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-40-1><a id=__codelineno-40-1 name=__codelineno-40-1 href=#__codelineno-40-1></a><span class=c1># Pre-fetch pack for offline use</span>
</span><span id=__span-40-2><a id=__codelineno-40-2 name=__codelineno-40-2 href=#__codelineno-40-2></a>assay<span class=w> </span>pack<span class=w> </span>fetch<span class=w> </span>eu-ai-act-pro@1.2.0
</span><span id=__span-40-3><a id=__codelineno-40-3 name=__codelineno-40-3 href=#__codelineno-40-3></a>
</span><span id=__span-40-4><a id=__codelineno-40-4 name=__codelineno-40-4 href=#__codelineno-40-4></a><span class=c1># Verify pack integrity</span>
</span><span id=__span-40-5><a id=__codelineno-40-5 name=__codelineno-40-5 href=#__codelineno-40-5></a>assay<span class=w> </span>pack<span class=w> </span>verify<span class=w> </span>eu-ai-act-pro@1.2.0
</span></code></pre></div> <hr> <h2 id=12-security-considerations>12. Security Considerations<a class=headerlink href=#12-security-considerations title="Permanent link">&para;</a></h2> <h3 id=121-token-security>12.1 Token Security<a class=headerlink href=#121-token-security title="Permanent link">&para;</a></h3> <ul> <li>Tokens SHOULD be short-lived (&lt; 24h for CI)</li> <li>Tokens MUST NOT be logged</li> <li>OIDC preferred over long-lived tokens</li> </ul> <h3 id=122-mitm-protection>12.2 MITM Protection<a class=headerlink href=#122-mitm-protection title="Permanent link">&para;</a></h3> <ul> <li>Registry MUST use HTTPS</li> <li>CLI MUST verify TLS certificates</li> <li>Digest verification provides content integrity</li> <li>Signature verification provides authenticity</li> </ul> <h3 id=123-supply-chain>12.3 Supply Chain<a class=headerlink href=#123-supply-chain title="Permanent link">&para;</a></h3> <ul> <li>Pack digests are computed from JCS-canonical content</li> <li>For <strong>signed commercial packs</strong>, unknown YAML fields MUST cause validation failure (no injection via ignored fields). For open packs or future schema evolution, implementations MAY treat unknown fields as lint warnings rather than hard failure if pack schema versioning allows additive extensions; normative behavior for commercial remains strict reject.</li> <li><strong>Commercial pack schema evolution:</strong> Adding new top-level or rule-level fields to the pack schema is <strong>breaking</strong> for commercial packs unless a pack schema version is introduced and clients opt-in. Commercial packs are versioned; additive schema changes require a bump of pack schema version and client support; otherwise existing commercial packs would break validation. This SPEC does not define pack schema versioning; it is stated here to avoid the assumption that "add a field, minor bump" is safe for commercial.</li> <li>Signed packs provide author verification</li> <li>Commercial packs MUST be signed (see §6.3)</li> </ul> <h3 id=124-yaml-parsing-security>12.4 YAML Parsing Security<a class=headerlink href=#124-yaml-parsing-security title="Permanent link">&para;</a></h3> <p>YAML parsers are vulnerable to DoS attacks. The following limits are <strong>implementation guidance</strong>; implementations SHOULD enforce them to prevent resource exhaustion. For normative canonicalization rules, see §6.1.</p> <table> <thead> <tr> <th>Attack</th> <th>Mitigation</th> </tr> </thead> <tbody> <tr> <td>Billion laughs (anchor expansion)</td> <td>Reject anchors/aliases (normative in §6.1)</td> </tr> <tr> <td>Deep nesting</td> <td>Limit depth to 50</td> </tr> <tr> <td>Huge strings</td> <td>Limit string length to 1MB</td> </tr> <tr> <td>Many keys</td> <td>Limit object keys to 10,000</td> </tr> </tbody> </table> <p><strong>Implementation</strong>: Use a parser with recursion/depth limits or validate structure before parsing; duplicate keys MUST be rejected (normative in §6.1).</p> <h3 id=125-size-limits>12.5 Size Limits<a class=headerlink href=#125-size-limits title="Permanent link">&para;</a></h3> <p>The following are <strong>implementation guidance</strong> (SHOULD) unless a future version makes them normative:</p> <table> <thead> <tr> <th>Limit</th> <th>Value</th> <th>Rationale</th> </tr> </thead> <tbody> <tr> <td>Max pack size</td> <td>10 MB</td> <td>Prevent DoS, reasonable for rule sets</td> </tr> <tr> <td>Max rules per pack</td> <td>1,000</td> <td>Performance</td> </tr> <tr> <td>Max string field</td> <td>1 MB</td> <td>Prevent memory exhaustion</td> </tr> </tbody> </table> <p>CLI SHOULD support <code>Accept-Encoding: gzip</code> and decompress transparently.</p> <hr> <h2 id=13-future-oci-distribution>13. Future: OCI Distribution<a class=headerlink href=#13-future-oci-distribution title="Permanent link">&para;</a></h2> <h3 id=131-rationale>13.1 Rationale<a class=headerlink href=#131-rationale title="Permanent link">&para;</a></h3> <p>OCI (Open Container Initiative) registries are increasingly used for non-container artifacts via ORAS (OCI Registry As Storage). Benefits:</p> <ul> <li>Existing auth infrastructure (Docker Hub, GHCR, ECR, etc.)</li> <li>Built-in signing via cosign/Sigstore</li> <li>Mirrors, caching, air-gapped support</li> <li>Ecosystem tooling</li> </ul> <h3 id=132-planned-support-v11>13.2 Planned Support (v1.1)<a class=headerlink href=#132-planned-support-v11 title="Permanent link">&para;</a></h3> <div class="language-bash highlight"><pre><span></span><code><span id=__span-41-1><a id=__codelineno-41-1 name=__codelineno-41-1 href=#__codelineno-41-1></a><span class=c1># OCI pull (by tag - discovery only)</span>
</span><span id=__span-41-2><a id=__codelineno-41-2 name=__codelineno-41-2 href=#__codelineno-41-2></a>assay<span class=w> </span>pack<span class=w> </span>pull<span class=w> </span>oci://ghcr.io/assay/packs/eu-ai-act-pro:1.2.0
</span><span id=__span-41-3><a id=__codelineno-41-3 name=__codelineno-41-3 href=#__codelineno-41-3></a>
</span><span id=__span-41-4><a id=__codelineno-41-4 name=__codelineno-41-4 href=#__codelineno-41-4></a><span class=c1># OCI pull (by digest - CI/builds)</span>
</span><span id=__span-41-5><a id=__codelineno-41-5 name=__codelineno-41-5 href=#__codelineno-41-5></a>assay<span class=w> </span>pack<span class=w> </span>pull<span class=w> </span>oci://ghcr.io/assay/packs/eu-ai-act-pro@sha256:abc123...
</span><span id=__span-41-6><a id=__codelineno-41-6 name=__codelineno-41-6 href=#__codelineno-41-6></a>
</span><span id=__span-41-7><a id=__codelineno-41-7 name=__codelineno-41-7 href=#__codelineno-41-7></a><span class=c1># Verify cosign signature</span>
</span><span id=__span-41-8><a id=__codelineno-41-8 name=__codelineno-41-8 href=#__codelineno-41-8></a>assay<span class=w> </span>pack<span class=w> </span>verify<span class=w> </span>oci://ghcr.io/assay/packs/eu-ai-act-pro@sha256:abc123...
</span></code></pre></div> <p><strong>OCI artifact layout (NORMATIVE for v1.1):</strong></p> <table> <thead> <tr> <th>Layer</th> <th>Media Type</th> <th>Content</th> </tr> </thead> <tbody> <tr> <td>Config</td> <td><code>application/vnd.assay.pack.config.v1+json</code></td> <td>Pack metadata (name, version, license)</td> </tr> <tr> <td>Layer 0</td> <td><code>application/vnd.assay.pack.content.v1+yaml</code></td> <td>Pack YAML content</td> </tr> </tbody> </table> <p><strong>Manifest annotations:</strong></p> <table> <thead> <tr> <th>Annotation</th> <th>Value</th> </tr> </thead> <tbody> <tr> <td><code>dev.assay.pack.name</code></td> <td>Pack name</td> </tr> <tr> <td><code>dev.assay.pack.version</code></td> <td>Semver version</td> </tr> <tr> <td><code>dev.assay.pack.digest</code></td> <td>Canonical digest (X-Pack-Digest equivalent)</td> </tr> </tbody> </table> <h3 id=133-digest-mapping>13.3 Digest Mapping<a class=headerlink href=#133-digest-mapping title="Permanent link">&para;</a></h3> <table> <thead> <tr> <th>HTTP Registry</th> <th>OCI Registry</th> </tr> </thead> <tbody> <tr> <td><code>X-Pack-Digest</code></td> <td>Manifest annotation + layer digest</td> </tr> <tr> <td><code>X-Pack-Signature</code></td> <td>cosign signature (attached or DSSE)</td> </tr> <tr> <td><code>X-Pack-Key-Id</code></td> <td>cosign public key / keyless identity</td> </tr> </tbody> </table> <p><strong>Signing (NORMATIVE for v1.1):</strong></p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-42-1><a id=__codelineno-42-1 name=__codelineno-42-1 href=#__codelineno-42-1></a><span class=c1># Sign with cosign (keyless)</span>
</span><span id=__span-42-2><a id=__codelineno-42-2 name=__codelineno-42-2 href=#__codelineno-42-2></a>cosign<span class=w> </span>sign<span class=w> </span>--yes<span class=w> </span>ghcr.io/assay/packs/eu-ai-act-pro@sha256:abc123...
</span><span id=__span-42-3><a id=__codelineno-42-3 name=__codelineno-42-3 href=#__codelineno-42-3></a>
</span><span id=__span-42-4><a id=__codelineno-42-4 name=__codelineno-42-4 href=#__codelineno-42-4></a><span class=c1># Verify</span>
</span><span id=__span-42-5><a id=__codelineno-42-5 name=__codelineno-42-5 href=#__codelineno-42-5></a>cosign<span class=w> </span>verify<span class=w> </span>ghcr.io/assay/packs/eu-ai-act-pro@sha256:abc123...<span class=w> </span><span class=se>\</span>
</span><span id=__span-42-6><a id=__codelineno-42-6 name=__codelineno-42-6 href=#__codelineno-42-6></a><span class=w>  </span>--certificate-identity<span class=o>=</span>release@assay.dev<span class=w> </span><span class=se>\</span>
</span><span id=__span-42-7><a id=__codelineno-42-7 name=__codelineno-42-7 href=#__codelineno-42-7></a><span class=w>  </span>--certificate-oidc-issuer<span class=o>=</span>https://accounts.google.com
</span></code></pre></div> <h3 id=134-ci-best-practice>13.4 CI Best Practice<a class=headerlink href=#134-ci-best-practice title="Permanent link">&para;</a></h3> <p><strong>Tags are mutable; digests are immutable.</strong> For reproducible builds:</p> <div class="language-yaml highlight"><pre><span></span><code><span id=__span-43-1><a id=__codelineno-43-1 name=__codelineno-43-1 href=#__codelineno-43-1></a><span class=c1># Discovery (get latest version)</span>
</span><span id=__span-43-2><a id=__codelineno-43-2 name=__codelineno-43-2 href=#__codelineno-43-2></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="p p-Indicator">|</span>
</span><span id=__span-43-3><a id=__codelineno-43-3 name=__codelineno-43-3 href=#__codelineno-43-3></a><span class=w>    </span><span class=no>DIGEST=$(assay pack resolve oci://ghcr.io/assay/packs/eu-ai-act-pro:1.2.0)</span>
</span><span id=__span-43-4><a id=__codelineno-43-4 name=__codelineno-43-4 href=#__codelineno-43-4></a><span class=w>    </span><span class=no>echo &quot;PACK_DIGEST=$DIGEST&quot; &gt;&gt; $GITHUB_ENV</span>
</span><span id=__span-43-5><a id=__codelineno-43-5 name=__codelineno-43-5 href=#__codelineno-43-5></a>
</span><span id=__span-43-6><a id=__codelineno-43-6 name=__codelineno-43-6 href=#__codelineno-43-6></a><span class=c1># Build (use digest)</span>
</span><span id=__span-43-7><a id=__codelineno-43-7 name=__codelineno-43-7 href=#__codelineno-43-7></a><span class="p p-Indicator">-</span><span class=w> </span><span class=nt>run</span><span class=p>:</span><span class=w> </span><span class="l l-Scalar l-Scalar-Plain">assay evidence lint --pack &quot;oci://ghcr.io/assay/packs/eu-ai-act-pro@$PACK_DIGEST&quot; bundle.tar.gz</span>
</span></code></pre></div> <h3 id=135-coexistence>13.5 Coexistence<a class=headerlink href=#135-coexistence title="Permanent link">&para;</a></h3> <p>HTTP registry and OCI distribution will coexist. <strong>OCI is an additional registry resolver class;</strong> it does not change the resolution order of path → built-in → local config dir → registry → BYOS (per SPEC-Pack-Engine-v1). When OCI is supported, "registry" is interpreted to include both HTTP registry and OCI registry (order between them is implementation-defined, typically HTTP before OCI).</p> <div class="language-bash highlight"><pre><span></span><code><span id=__span-44-1><a id=__codelineno-44-1 name=__codelineno-44-1 href=#__codelineno-44-1></a><span class=c1># HTTP registry (default)</span>
</span><span id=__span-44-2><a id=__codelineno-44-2 name=__codelineno-44-2 href=#__codelineno-44-2></a>--pack<span class=w> </span>eu-ai-act-pro@1.2.0
</span><span id=__span-44-3><a id=__codelineno-44-3 name=__codelineno-44-3 href=#__codelineno-44-3></a>
</span><span id=__span-44-4><a id=__codelineno-44-4 name=__codelineno-44-4 href=#__codelineno-44-4></a><span class=c1># OCI registry (explicit)</span>
</span><span id=__span-44-5><a id=__codelineno-44-5 name=__codelineno-44-5 href=#__codelineno-44-5></a>--pack<span class=w> </span>oci://ghcr.io/assay/packs/eu-ai-act-pro:1.2.0
</span></code></pre></div> <p>Resolution order with OCI (informative):</p> <div class="language-text highlight"><pre><span></span><code><span id=__span-45-1><a id=__codelineno-45-1 name=__codelineno-45-1 href=#__codelineno-45-1></a>1. Local path      ./custom.yaml
</span><span id=__span-45-2><a id=__codelineno-45-2 name=__codelineno-45-2 href=#__codelineno-45-2></a>2. Bundled pack    eu-ai-act-baseline
</span><span id=__span-45-3><a id=__codelineno-45-3 name=__codelineno-45-3 href=#__codelineno-45-3></a>3. HTTP registry   eu-ai-act-pro@1.2.0
</span><span id=__span-45-4><a id=__codelineno-45-4 name=__codelineno-45-4 href=#__codelineno-45-4></a>4. OCI registry    oci://ghcr.io/.../pack:1.2.0
</span><span id=__span-45-5><a id=__codelineno-45-5 name=__codelineno-45-5 href=#__codelineno-45-5></a>5. BYOS            s3://bucket/packs/...
</span></code></pre></div> <hr> <h2 id=14-implementation-checklist>14. Implementation Checklist<a class=headerlink href=#14-implementation-checklist title="Permanent link">&para;</a></h2> <h3 id=phase-1-v10>Phase 1 (v1.0)<a class=headerlink href=#phase-1-v10 title="Permanent link">&para;</a></h3> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Pack resolution order in CLI (per SPEC-Pack-Engine-v1)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Registry client with token auth</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> OIDC token exchange endpoint (<code>POST /auth/oidc/exchange</code>)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Strict YAML parsing (reject anchors, duplicates, tags, floats; see §6.1)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Digest verification (JCS canonical)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> DSSE envelope signature verification (MUST for commercial; missing signature = fail)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Pinned root keys (embedded + config hierarchy) + keys manifest fetch</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Cache integrity verification on every read (commercial: signature required)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Local caching with TTL + ETag/304 + Vary (cache path includes registry/namespace when applicable)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Lockfile v2 support (<code>assay.packs.lock</code>) — format defined in §8</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> HEAD endpoint support</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> <code>assay config set registry.*</code> commands</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> BYOS pack fetch (S3/GCS/Azure); expected digest from pin suffix or lockfile</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Error messages per §10</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Rate limit handling (429 + Retry-After)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> 410 revocation handling + <code>--allow-revoked</code> (CI detection per §4.3)</li> </ul> <h3 id=phase-2-v11>Phase 2 (v1.1)<a class=headerlink href=#phase-2-v11 title="Permanent link">&para;</a></h3> <ul class=task-list> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Keyless signing (Sigstore/Fulcio)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> OCI distribution support (ORAS)</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> cosign verification integration</li> <li class=task-list-item><label class=task-list-control><input type=checkbox disabled><span class=task-list-indicator></span></label> Organization namespaces</li> </ul> <hr> <h2 id=15-references>15. References<a class=headerlink href=#15-references title="Permanent link">&para;</a></h2> <h3 id=normative>Normative<a class=headerlink href=#normative title="Permanent link">&para;</a></h3> <ul> <li><a href=../ADR-016-Pack-Taxonomy/ >ADR-016: Pack Taxonomy</a></li> <li><a href=../SPEC-Pack-Engine-v1/ >SPEC-Pack-Engine-v1</a></li> <li><a href=../SPEC-Tool-Signing-v1/ >SPEC-Tool-Signing-v1</a></li> <li><a href=https://datatracker.ietf.org/doc/html/rfc8785>RFC 8785 - JCS</a> — JSON Canonicalization Scheme</li> <li><a href=https://datatracker.ietf.org/doc/html/rfc9530>RFC 9530 - Digest Fields</a> — HTTP Content-Digest</li> <li><a href=https://github.com/secure-systems-lab/dsse>DSSE</a> — Dead Simple Signing Envelope</li> </ul> <h3 id=informative>Informative<a class=headerlink href=#informative title="Permanent link">&para;</a></h3> <ul> <li><a href=https://sigstore.dev>Sigstore</a> — Keyless signing</li> <li><a href=https://oras.land>ORAS</a> — OCI Registry As Storage</li> <li><a href=https://www.openpolicyagent.org/docs/latest/management-bundles/ >OPA Bundle Distribution</a> — Similar pattern</li> <li><a href=https://theupdateframework.io>TUF</a> — Update security framework</li> <li><a href=https://docs.sigstore.dev/cosign/overview/ >cosign</a> — Container signing</li> </ul> </article> </div> <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var tab,labels=set.querySelector(".tabbed-labels");for(tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script> <script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script> </div> <button type=button class="md-top md-icon" data-md-component=top hidden> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg> Back to top </button> </main> <footer class=md-footer> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-copyright> <div class=md-copyright__highlight> Copyright &copy; 2025 Assay </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-social> <a href=https://github.com/Rul1an/assay target=_blank rel=noopener title=github.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 496 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg> </a> <a href=https://twitter.com/assay_dev target=_blank rel=noopener title=twitter.com class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://discord.gg/assay target=_blank rel=noopener title=discord.gg class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 640 512"><!-- Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg> </a> <a href=https://getassay.dev target=_blank rel=noopener title=getassay.dev class=md-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M5 20h14v-2H5m14-9h-4V3H9v6H5l7 7 7-7Z"/></svg> </a> </div> </div> </div> </footer> </div> <div class=md-dialog data-md-component=dialog> <div class="md-dialog__inner md-typeset"></div> </div> <script id=__config type=application/json>{"base": "../..", "features": ["navigation.instant", "navigation.instant.prefetch", "navigation.tracking", "navigation.tabs", "navigation.tabs.sticky", "navigation.sections", "navigation.expand", "navigation.path", "navigation.top", "search.suggest", "search.highlight", "search.share", "content.code.copy", "content.code.annotate", "content.tabs.link", "toc.follow"], "search": "../../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": {"provider": "mike"}}</script> <script src=../../assets/javascripts/bundle.fe8b6f2b.min.js></script> </body> </html>